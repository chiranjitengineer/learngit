DROP TABLE PF_ARREAR_DATA

CREATE TABLE PF_ARREAR_DATA
(
    COMPANYCODE     VARCHAR2(10),	
    DIVISIONCODE     VARCHAR2(10),	
    TOKENNO     VARCHAR2(10),	
    NAME	     VARCHAR2(210),
    PF_GROSS	NUMBER(15,2),
    PF_E		NUMBER(15,2),
    VPF		NUMBER(15,2),
    PF_C		NUMBER(15,2),
    TOTAL_PF	NUMBER(15,2)
)

select * from PF_ARREAR_DATA


CREATE TABLE NEW_ARREAR_DATA
(
    TOKENNO         VARCHAR2(10),	
    NAME		VARCHAR2(200),
    OLD_SAL	        NUMBER(15,2),
    NEW_SAL	        NUMBER(15,2),	
    ARR_SAL	        NUMBER(15,2),	
    ARR_SAL_TOT	        NUMBER(15,2),	
    PF_PERC		        NUMBER(15,2),
    PF_E	        NUMBER(15,2),	
    VPF_PERC	        NUMBER(15,2),	
    VPF		        NUMBER(15,2),
    NETSALARY	        NUMBER(15,2)
)


SELECT * FROM NEW_ARREAR_DATA


SELECT * FROM PISARREARTRANSACTION
WHERE YEARMONTH='202010'
AND TOKENNO IN (
    SELECT TOKENNO FROM NEW_ARREAR_DATA
)


CREATE TABLE PISARREARTRANSACTION_BK AS

DELETE FROM PISARREARTRANSACTION
WHERE YEARMONTH='202010'





SELECT * FROM NEW_ARREAR_DATA
WHERE TOKENNO NOT IN (
select TOKENNO from PF_ARREAR_DATA
)

SELECT * FROM NEW_ARREAR_DATA A, PF_ARREAR_DATA B
WHERE A.TOKENNO=B.TOKENNO(+)


SELECT A.TOKENNO,A.ARR_SAL_TOT, NVL(B.PF_GROSS,0) PF_GROSS, NVL(B.PF_E,0) PF_E,NVL(B.PF_C,0) PF_C, NVL(B.VPF,0) VPF 
FROM NEW_ARREAR_DATA A, PF_ARREAR_DATA B
WHERE A.TOKENNO=B.TOKENNO(+)

WHERE TOKENNO NOT IN (
select TOKENNO from PF_ARREAR_DATA
)


SELECT COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, 
GRADECODE, WORKERSERIAL, TOKENNO, TRANSACTIONTYPE, PAYMODE 
FROM PISARREARTRANSACTION
WHERE YEARMONTH='202010'
AND TOKENNO IN (
    SELECT TOKENNO FROM NEW_ARREAR_DATA
)


SELECT * FROM NEW_ARREAR_DATA A, PF_ARREAR_DATA B
WHERE A.TOKENNO=B.TOKENNO(+)

SELECT COMPANYCODE, DIVISIONCODE,'2020-2021' YEARCODE,'202010' YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, 
GRADECODE, WORKERSERIAL, A.TOKENNO,'ARREAR' TRANSACTIONTYPE,'BANK' PAYMODE,
 ARR_SAL_TOT,PF_GROSS,PF_E,PF_C,VPF,ARR_SAL_TOT GROSSEARN, (PF_E+PF_C+VPF) GROSSDEDN, (ARR_SAL_TOT-((PF_E+PF_C+VPF))) NETSALARY
FROM PISEMPLOYEEMASTER A,
(
SELECT A.TOKENNO,A.ARR_SAL_TOT, NVL(B.PF_GROSS,0) PF_GROSS, NVL(B.PF_E,0) PF_E,NVL(B.PF_C,0) PF_C, NVL(B.VPF,0) VPF 
FROM NEW_ARREAR_DATA A, PF_ARREAR_DATA B
WHERE A.TOKENNO=B.TOKENNO(+)
) B
WHERE A.TOKENNO=B.TOKENNO


SELECT COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, GRADECODE, WORKERSERIAL, TOKENNO, TRANSACTIONTYPE, PAYMODE,
BASIC,PF_GROSS,PF_E,PF_C,VPF,GROSSEARN,GROSSDEDN,NETSALARY
FROM PISARREARTRANSACTION

INSERT INTO PISARREARTRANSACTION
(
    COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, GRADECODE, WORKERSERIAL, TOKENNO, TRANSACTIONTYPE, PAYMODE,
    BASIC,PF_GROSS,PF_E,PF_C,VPF,GROSSEARN,GROSSDEDN,NETSALARY
)
SELECT COMPANYCODE, DIVISIONCODE,'2020-2021' YEARCODE,'202010' YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, 
GRADECODE, WORKERSERIAL, A.TOKENNO,'ARREAR' TRANSACTIONTYPE,'BANK' PAYMODE,
ARR_SAL_TOT,PF_GROSS,PF_E,PF_C,VPF,ARR_SAL_TOT GROSSEARN, (PF_E+VPF) GROSSDEDN, (ARR_SAL_TOT-((PF_E+VPF))) NETSALARY
FROM PISEMPLOYEEMASTER A,
(
    SELECT A.TOKENNO,A.ARR_SAL_TOT, NVL(B.PF_GROSS,0) PF_GROSS, NVL(B.PF_E,0) PF_E,NVL(B.PF_C,0) PF_C, NVL(B.VPF,0) VPF 
    FROM NEW_ARREAR_DATA A, PF_ARREAR_DATA B
    WHERE A.TOKENNO=B.TOKENNO(+)
) B
WHERE A.TOKENNO=B.TOKENNO


SELECT * FROM PISARREARTRANSACTION
WHERE YEARMONTH='202010'

AND TOKENNO IN 
(
    SELECT TOKENNO FROM 
)

