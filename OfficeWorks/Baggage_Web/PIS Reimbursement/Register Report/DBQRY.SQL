SELECT * FROM PISPAYTRANSACTION
WHERE DIVISIONCODE='002'
--AND CATEGORYCODE='02'
AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202006

SELECT * FROM PISCOMPONENTMASTER
WHERE DIVISIONCODE ='001'
AND COMPONENTTYPE='EARNING'
ORDER BY PHASE, CALCULATIONINDEX

SELECT WM_CONCAT('SUM('||COMPONENTCODE||') '||COMPONENTCODE) FROM 
(
    SELECT COMPONENTCODE FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND COMPONENTTYPE='EARNING'
    ORDER BY PHASE, CALCULATIONINDEX
)



SELECT WM_CONCAT('SUM('||COMPONENTCODE||') '||COMPONENTCODE) FROM 
(
    SELECT COMPONENTCODE FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND (COMPONENTTYPE='DEDUCTION' OR COMPONENTCODE IN ('TOTLOANAMT','TOTLOANINT'))
    AND (COMPONENTCODE NOT LIKE 'LINT%' AND COMPONENTCODE NOT LIKE 'LOAN%')
    ORDER BY PHASE, CALCULATIONINDEX
)



SELECT WM_CONCAT(COMPONENTCODE) FROM 
(
    SELECT COMPONENTCODE FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND ALLOWREIMBURSEMENT='Y'
    ORDER BY PHASE, CALCULATIONINDEX
)




SELECT WM_CONCAT(COMPONENTSHORTNAME) FROM 
(
    SELECT COMPONENTSHORTNAME FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND COMPONENTTYPE='EARNING'
    ORDER BY PHASE, CALCULATIONINDEX
)

SELECT WM_CONCAT(COMPONENTSHORTNAME) FROM 
(
    SELECT COMPONENTSHORTNAME FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND COMPONENTTYPE='DEDUCTION'
    ORDER BY PHASE, CALCULATIONINDEX
)


SELECT WM_CONCAT(COMPONENTSHORTNAME) FROM 
(
    SELECT COMPONENTSHORTNAME FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND ALLOWREIMBURSEMENT='Y'
    ORDER BY PHASE, CALCULATIONINDEX
)



SELECT TOKENNO,
SUM(BASIC) BASIC,SUM(SOFT_ALLW) SOFT_ALLW,SUM(SERV_ALLW) SERV_ALLW,
SUM(CONV_ALLW) CONV_ALLW,SUM(CHILD_ALLW) CHILD_ALLW,SUM(PERS_ALLW) PERS_ALLW,
SUM(HRA) HRA,SUM(OTH_ALLW) OTH_ALLW,SUM(INCENTIVE) INCENTIVE,SUM(FIX_ALW) FIX_ALW,
SUM(OTH_ALLW2) OTH_ALLW2,SUM(OTHER_REIM) OTHER_REIM,SUM(SARR_ARRE) SARR_ARRE,
SUM(FSTL_EARN) FSTL_EARN,SUM(NETSALARY) NETSALARY 
FROM PISPAYTRANSACTION
WHERE DIVISIONCODE='001'
AND CATEGORYCODE='02'
AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202006
GROUP BY TOKENNO


SELECT TOKENNO,
SUM(LINT_HBLN) LINT_HBLN,SUM(LINT_PF) LINT_PF,SUM(ESI_E) ESI_E,SUM(PF_E) PF_E,
SUM(PTAX) PTAX,SUM(ITAX) ITAX,SUM(LOAN_SADV) LOAN_SADV,SUM(LINT_SADV) LINT_SADV,
SUM(CANTEEN) CANTEEN,SUM(LOAN_PRLN) LOAN_PRLN,SUM(LOAN_EDLN) LOAN_EDLN,
SUM(LINT_PRLN) LINT_PRLN,SUM(LINT_EDLN) LINT_EDLN,SUM(LOAN_OTLN) LOAN_OTLN,
SUM(LINT_OTLN) LINT_OTLN,SUM(LOAN_VCLN) LOAN_VCLN,SUM(LINT_VCLN) LINT_VCLN,
SUM(LOAN_MGLN) LOAN_MGLN,SUM(LINT_MGLN) LINT_MGLN,SUM(LOAN_MDLN) LOAN_MDLN,
SUM(LINT_MDLN) LINT_MDLN,SUM(LOAN_HBLN) LOAN_HBLN,SUM(LOAN_PF) LOAN_PF,
SUM(SAL_SAVING) SAL_SAVING,SUM(SARR_ARRD) SARR_ARRD,SUM(FSTL_DED) FSTL_DED
FROM PISPAYTRANSACTION
WHERE DIVISIONCODE='001'
AND CATEGORYCODE='02'
AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202006
GROUP BY TOKENNO


SELECT * FROM PISREIMBURSEMENTDETAILS


SELECT TOKENNO,LTA,MEDICAL,FIX_CONV,LOCAL_CONV,TELEPHONE,BONUS,OTHER_REIM,EXGRATIA FROM 
(
    ( 
        SELECT COMPANYCODE, DIVISIONCODE,YEARCODE,YEARMONTH,WORKERSERIAL,TOKENNO, COMPONENTCODE, PAIDAMOUNT , BILLAMOUNT 
        FROM PISREIMBURSEMENTDETAILS
    )
    PIVOT(
        SUM(PAIDAMOUNT)
        FOR COMPONENTCODE
        IN ( 
            'LTA' AS LTA, 
            'MEDICAL' AS MEDICAL,
            'FIX_CONV' AS FIX_CONV,
            'LOCAL_CONV' AS LOCAL_CONV,
            'TELEPHONE' AS TELEPHONE,
            'BONUS' AS BONUS,
            'OTHER_REIM' AS OTHER_REIM,
            'EXGRATIA' AS EXGRATIA 
        )
    )
)

ORDER BY COMPONENTCODE





SELECT WM_CONCAT(''''||COMPONENTCODE||''' AS '||COMPONENTCODE) FROM 
(
    SELECT COMPONENTCODE FROM PISCOMPONENTMASTER
    WHERE DIVISIONCODE ='001'
    AND ALLOWREIMBURSEMENT='Y'
    ORDER BY PHASE, CALCULATIONINDEX
)


DROP VIEW VW_REIMBURSEMENT_REG

EXEC PROC_RPT_REIMBURSEMENT_REG_EXL('0001','001','2020-2021','APR-20','AUG-20','''001''','''02''','','','')


PROC_RPT_REIMBURSEMENT_REG_EXL('COMPANYCODE','DIVISIONCODE','YEARCODE','ddlYEARMONTHSHOW','ddlYEARMONTHSHOW2','btnUnit','btnCategory','btnGrade','btnEmployee','btnCOLUMNS')



SELECT * FROM VW_REIMBURSEMENT_REG

FN_GET_EXCEL_CELLREF(111)

CREATE GLOBAL TEMPORARY TABLE GTT_EXCEL_REPORT
(
  ROWINDEX       NUMBER(20),
  EXCELROWTYPE   VARCHAR2(50 BYTE),
  EXCELROWSTYLE  VARCHAR2(500 BYTE),
  EXCELVALUES    VARCHAR2(3000 BYTE),
  EXCELTAG       VARCHAR2(500 BYTE)
)
ON COMMIT PRESERVE ROWS
NOCACHE;



SELECT '^'||UNITCODE^TOKENNO^EMPLOYEENAME^GRADECODE^CATEGORYCODE^BASIC||'^'||SOFT_ALLW||'^'||SERV_ALLW||'^'||CONV_ALLW||'^'||CHILD_ALLW||'^'||PERS_ALLW||'^'||HRA||'^'||OTH_ALLW||'^'||INCENTIVE||'^'||FIX_ALW||'^'||OTH_ALLW2||'^'||SARR_ARRE||'^'||FSTL_EARN||'^'||NETSALARY^LTA||'^'||MEDICAL||'^'||FIX_CONV||'^'||LOCAL_CONV||'^'||TELEPHONE||'^'||BONUS||'^'||OTHER_REIM||'^'||EXGRATIA^ESI_E||'^'||PF_E||'^'||PTAX||'^'||ITAX||'^'||CANTEEN||'^'||TOTLOANAMT||'^'||TOTLOANINT||'^'||SAL_SAVING||'^'||SARR_ARRD||'^'||FSTL_DED FROM VW_REIMBURSEMENT_REG WHERE TOKENNO='00137'


SELECT * FROM GTT_EXCEL_REPORT

SELECT * FROM MENUMASTER_RND
WHERE MENUDESC LIKE 'Wage%'

roledetails223.31.219.122


SELECT * FROM 
(
    SELECT TOKENNO,
    SUM(BASIC) BASIC,SUM(SOFT_ALLW) SOFT_ALLW,SUM(SERV_ALLW) SERV_ALLW,
    SUM(CONV_ALLW) CONV_ALLW,SUM(CHILD_ALLW) CHILD_ALLW,SUM(PERS_ALLW) PERS_ALLW,
    SUM(HRA) HRA,SUM(OTH_ALLW) OTH_ALLW,SUM(INCENTIVE) INCENTIVE,SUM(FIX_ALW) FIX_ALW,
    SUM(OTH_ALLW2) OTH_ALLW2,SUM(OTHER_REIM) OTHER_REIM,SUM(SARR_ARRE) SARR_ARRE,
    SUM(FSTL_EARN) FSTL_EARN,SUM(NETSALARY) NETSALARY 
    FROM PISPAYTRANSACTION
    WHERE DIVISIONCODE='001'
    AND CATEGORYCODE='02'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202006
    GROUP BY TOKENNO
) A,
(
    SELECT * FROM 
    (
        ( 
            SELECT TOKENNO, COMPONENTCODE, PAIDAMOUNT
            FROM PISREIMBURSEMENTDETAILS
        )
        PIVOT(
            SUM(PAIDAMOUNT)
            FOR COMPONENTCODE
            IN ( 
                'LTA' AS LTA, 
                'MEDICAL' AS MEDICAL,
                'FIX_CONV' AS FIX_CONV,
                'LOCAL_CONV' AS LOCAL_CONV
            )
        )
    )
) B,
(
    SELECT TOKENNO,
    SUM(LINT_HBLN) LINT_HBLN,SUM(LINT_PF) LINT_PF,SUM(ESI_E) ESI_E,SUM(PF_E) PF_E,
    SUM(PTAX) PTAX,SUM(ITAX) ITAX,SUM(LOAN_SADV) LOAN_SADV,SUM(LINT_SADV) LINT_SADV,
    SUM(CANTEEN) CANTEEN,SUM(LOAN_PRLN) LOAN_PRLN,SUM(LOAN_EDLN) LOAN_EDLN,
    SUM(LINT_PRLN) LINT_PRLN,SUM(LINT_EDLN) LINT_EDLN,SUM(LOAN_OTLN) LOAN_OTLN,
    SUM(LINT_OTLN) LINT_OTLN,SUM(LOAN_VCLN) LOAN_VCLN,SUM(LINT_VCLN) LINT_VCLN,
    SUM(LOAN_MGLN) LOAN_MGLN,SUM(LINT_MGLN) LINT_MGLN,SUM(LOAN_MDLN) LOAN_MDLN,
    SUM(LINT_MDLN) LINT_MDLN,SUM(LOAN_HBLN) LOAN_HBLN,SUM(LOAN_PF) LOAN_PF,
    SUM(SAL_SAVING) SAL_SAVING,SUM(SARR_ARRD) SARR_ARRD,SUM(FSTL_DED) FSTL_DED
    FROM PISPAYTRANSACTION
    WHERE DIVISIONCODE='001'
    AND CATEGORYCODE='02'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202006
    GROUP BY TOKENNO
) C
WHERE A.TOKENNO=B.TOKENNO
AND A.TOKENNO=C.TOKENNO


CREATE OR REPLACE VIEW VW_REIMBURSEMENT_REG AS

SELECT E.UNITCODE, E.TOKENNO, E.EMPLOYEENAME, E.GRADECODE, E.CATEGORYCODE,BASIC,SOFT_ALLW,SERV_ALLW,CONV_ALLW,CHILD_ALLW,PERS_ALLW,HRA,OTH_ALLW,INCENTIVE,FIX_ALW,OTH_ALLW2,SARR_ARRE,FSTL_EARN,NETSALARY,LTA,MEDICAL,FIX_CONV,LOCAL_CONV,TELEPHONE,BONUS,OTHER_REIM,EXGRATIA,ESI_E,PF_E,PTAX,ITAX,CANTEEN,TOTLOANAMT,TOTLOANINT,SAL_SAVING,SARR_ARRD,FSTL_DED FROM 
(
    SELECT TOKENNO,SUM(BASIC) BASIC,SUM(SOFT_ALLW) SOFT_ALLW,SUM(SERV_ALLW) SERV_ALLW,SUM(CONV_ALLW) CONV_ALLW,SUM(CHILD_ALLW) CHILD_ALLW,SUM(PERS_ALLW) PERS_ALLW,SUM(HRA) HRA,SUM(OTH_ALLW) OTH_ALLW,SUM(INCENTIVE) INCENTIVE,SUM(FIX_ALW) FIX_ALW,SUM(OTH_ALLW2) OTH_ALLW2,SUM(SARR_ARRE) SARR_ARRE,SUM(FSTL_EARN) FSTL_EARN,SUM(NETSALARY) NETSALARY
    FROM PISPAYTRANSACTION
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202008
    GROUP BY TOKENNO
) A,
(
    SELECT * FROM 
    (
        ( 
            SELECT TOKENNO, COMPONENTCODE, PAIDAMOUNT
            FROM PISREIMBURSEMENTDETAILS
        )
        PIVOT(
            SUM(PAIDAMOUNT)
            FOR COMPONENTCODE
            IN ( 
                'LTA' AS LTA,'MEDICAL' AS MEDICAL,'FIX_CONV' AS FIX_CONV,'LOCAL_CONV' AS LOCAL_CONV,'TELEPHONE' AS TELEPHONE,'BONUS' AS BONUS,'OTHER_REIM' AS OTHER_REIM,'EXGRATIA' AS EXGRATIA
            )
        )
    )
) B,
(
    SELECT TOKENNO,SUM(ESI_E) ESI_E,SUM(PF_E) PF_E,SUM(PTAX) PTAX,SUM(ITAX) ITAX,SUM(CANTEEN) CANTEEN,SUM(TOTLOANAMT) TOTLOANAMT,SUM(TOTLOANINT) TOTLOANINT,SUM(SAL_SAVING) SAL_SAVING,SUM(SARR_ARRD) SARR_ARRD,SUM(FSTL_DED) FSTL_DED
    FROM PISPAYTRANSACTION
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202008
    GROUP BY TOKENNO
) C,
(
    SELECT * FROM PISEMPLOYEEMASTER
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
) E
WHERE A.TOKENNO=B.TOKENNO
AND A.TOKENNO=C.TOKENNO
AND A.TOKENNO=E.TOKENNO



CREATE OR REPLACE VIEW VW_REIMBURSEMENT_REG AS
SELECT E.UNITCODE, E.TOKENNO, E.EMPLOYEENAME, E.GRADECODE, E.CATEGORYCODE,BASIC,SOFT_ALLW,SERV_ALLW,CONV_ALLW,CHILD_ALLW,PERS_ALLW,HRA,OTH_ALLW,INCENTIVE,FIX_ALW,OTH_ALLW2,SARR_ARRE,FSTL_EARN,NETSALARY,LTA,MEDICAL,FIX_CONV,LOCAL_CONV,TELEPHONE,BONUS,OTHER_REIM,EXGRATIA,ESI_E,PF_E,PTAX,ITAX,CANTEEN,TOTLOANAMT,TOTLOANINT,SAL_SAVING,SARR_ARRD,FSTL_DED FROM 
(
    SELECT TOKENNO,SUM(BASIC) BASIC,SUM(SOFT_ALLW) SOFT_ALLW,SUM(SERV_ALLW) SERV_ALLW,SUM(CONV_ALLW) CONV_ALLW,SUM(CHILD_ALLW) CHILD_ALLW,SUM(PERS_ALLW) PERS_ALLW,SUM(HRA) HRA,SUM(OTH_ALLW) OTH_ALLW,SUM(INCENTIVE) INCENTIVE,SUM(FIX_ALW) FIX_ALW,SUM(OTH_ALLW2) OTH_ALLW2,SUM(SARR_ARRE) SARR_ARRE,SUM(FSTL_EARN) FSTL_EARN,SUM(NETSALARY) NETSALARY
    FROM PISPAYTRANSACTION
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202008
    GROUP BY TOKENNO
) A,
(
    SELECT * FROM 
    (
        ( 
            SELECT TOKENNO, COMPONENTCODE, PAIDAMOUNT
            FROM PISREIMBURSEMENTDETAILS
        )
        PIVOT(
            SUM(PAIDAMOUNT)
            FOR COMPONENTCODE
            IN ( 
                'LTA' AS LTA,'MEDICAL' AS MEDICAL,'FIX_CONV' AS FIX_CONV,'LOCAL_CONV' AS LOCAL_CONV,'TELEPHONE' AS TELEPHONE,'BONUS' AS BONUS,'OTHER_REIM' AS OTHER_REIM,'EXGRATIA' AS EXGRATIA
            )
        )
    )
) B,
(
    SELECT TOKENNO,SUM(ESI_E) ESI_E,SUM(PF_E) PF_E,SUM(PTAX) PTAX,SUM(ITAX) ITAX,SUM(CANTEEN) CANTEEN,SUM(TOTLOANAMT) TOTLOANAMT,SUM(TOTLOANINT) TOTLOANINT,SUM(SAL_SAVING) SAL_SAVING,SUM(SARR_ARRD) SARR_ARRD,SUM(FSTL_DED) FSTL_DED
    FROM PISPAYTRANSACTION
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
    AND TO_NUMBER(YEARMONTH) BETWEEN 202004 AND 202008
    GROUP BY TOKENNO
) C,
(
    SELECT * FROM PISEMPLOYEEMASTER
    WHERE COMPANYCODE='0001'
    AND DIVISIONCODE='001'
) E
WHERE A.TOKENNO=B.TOKENNO
AND A.TOKENNO=C.TOKENNO
AND A.TOKENNO=E.TOKENNO


SELECT '^'||UNITCODE'^'TOKENNO'^'EMPLOYEENAME'^'GRADECODE'^'CATEGORYCODE||'^'||BASIC||'^'||SOFT_ALLW||'^'||SERV_ALLW||'^'||CONV_ALLW||'^'||CHILD_ALLW||'^'||PERS_ALLW||'^'||HRA||'^'||OTH_ALLW||'^'||INCENTIVE||'^'||FIX_ALW||'^'||OTH_ALLW2||'^'||SARR_ARRE||'^'||FSTL_EARN||'^'||NETSALARY||'^'||LTA||'^'||MEDICAL||'^'||FIX_CONV||'^'||LOCAL_CONV||'^'||TELEPHONE||'^'||BONUS||'^'||OTHER_REIM||'^'||EXGRATIA||'^'||ESI_E||'^'||PF_E||'^'||PTAX||'^'||ITAX||'^'||CANTEEN||'^'||TOTLOANAMT||'^'||TOTLOANINT||'^'||SAL_SAVING||'^'||SARR_ARRD||'^'||FSTL_DED FROM VW_REIMBURSEMENT_REG WHERE TOKENNO='00137'


---------------------------------------------------------------

SET DEFINE OFF;
Insert into BAGGAGE_WEB.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('1', '0107030316', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202005271045580008869987');
Insert into BAGGAGE_WEB.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('41', '0107030316', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202007271200570009117091');
Insert into BAGGAGE_WEB.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('25', '0107030316', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202009051116570009280200');
Insert into BAGGAGE_WEB.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('35', '0107030316', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202009031725040009273511');
COMMIT;
