
--naihati new pf loan interest adjustment interface -- 07/09/2020

------------------------------------------------------------------------------------------
 



SELECT * FROM SYS_HELP_QRY
WHERE QRY_ID='8002'


SELECT  * FROM MENUMASTER_RND
WHERE MENUCODE = '01110211'

SELECT * FROM MENUMASTER_RND
WHERE UPPER(MENUDESC) LIKE UPPER('%STAFF%')

SELECT  * FROM ROLEDETAILS
WHERE MENUCODE = '01110211'

SELECT  * FROM REPORTPARAMETERMASTER
WHERE REPORTAG = ''



SET DEFINE OFF;
Insert into MENUMASTER_RND
   (MENUCODE, MENUNAME, MENUDESC, MENUTYPE, MENUTAG, 
    MENUTAG1, MENUTAG2, ENTRYPOSSIBLE, EDITPOSSIBLE, DELETEPOSSIBLE, 
    REPORTSPOSSIBLE, UTILITIESPOSSIBLE, ACTIVE, PROJECTNAME, MENUDETAILS, 
    EFFECTIVEDIVISION, EFFECTIVEINDIVISION, PROCEDURE_SAVE_EDIT, URLSRC, FRM_HEIGHT, 
    FRM_WIDTH, FUNCTIONCALL_BEFORE, FUNCTIONCALL_AFTER, VIEWPOSSIBLE, PRINTPOSSIBLE, 
    DOCDATEVALIDATEFIELD, KEY_TABLE, KEY_COLUMN)
 Values
   ('01110211', NULL, 'PF Loan Interest Adjustment', 'TRANSACTIONS', 'PF LOAN INTEREST ADJUSTMENT', 
    NULL, NULL, 'Y', 'N', 'N', 
    'N', 'N', 'Y', 'PFACCOUNTS', NULL, 
    '''0010''', '''0010''', NULL, 'PF ACCOUNTS/Pages/Transaction/pgPFLoanInterestAdjustment.aspx', NULL, 
    NULL, 'prcPIS_STF_DTULD_b4Save', NULL, 'N', NULL, 
    NULL, NULL, NULL);
COMMIT;


SET DEFINE OFF;
Insert into ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('1', '01110211', 'Y', 'X', 'Y', 
    'X', 'X', 'X', 'X', 'PFACCOUNTS', 
    '202006082014310004040225');
COMMIT;



DROP TABLE PFLOANINTERESTADJUSMENT


CREATE TABLE PFLOANINTERESTADJUSMENT
(
COMPANYCODE VARCHAR2(10),
DIVISIONCODE VARCHAR2(10),
PFNO VARCHAR2(10),
TOKENNO VARCHAR2(10),
WORKERSERIAL VARCHAR2(10),
LOANCODE VARCHAR2(10),
LOANDATE DATE,
ASONCAPITALBAL NUMBER(15,2),
ASONINTERESTBAL NUMBER(15,2),
SANCTIONAMOUNT NUMBER(15,2),
INTERESTAMOUNT NUMBER(15,2),
MERGELOANAMOUNT NUMBER(15,2),
ADJINTERESTAMOUNT NUMBER(15,2),
ADJUSTMENTAMOUNT NUMBER(15,2),
ADJUSTEDAMOUNT NUMBER(15,2),
ADJUSTMENTDATE DATE,
REMARKS VARCHAR2(200),
LASTMODIFIED DATE DEFAULT SYSDATE,
USERNAME VARCHAR2(10) 
)

    EXEC PROC_CREATE_SYSTFMAP('PFLOANINTERESTADJUSMENT','COMPANYCODE, DIVISIONCODE, TOKENNO, WORKERSERIAL, LOANCODE, LOANDATE') 

    SELECT * FROM PFLOANINTEREST

--DELETE FROM SYS_TFMAP WHERE  SYS_TABLE_SEQUENCIER = 20122


    SELECT * FROM SYS_TFMAP WHERE  SYS_TABLE_SEQUENCIER = 20122

    EXEC PROC_CREATE_GBL_TMP_TABLES(20122,0)

   SELECT * FROM PFLOANINTERESTADJUSMENT
   
   
   COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, FORTNIGHTSTARTDATE, FORTNIGHTENDDATE, PFNO, LOANCODE, LOANDATE, LOANAMOUNT, INTERESTAPPLICABLEON, INTERESTPERCENTAGE, INTERESTAMOUNT, EMPLOYEECOMPANYCODE, EMPLOYEEDIVISIONCODE, MODULE, TRANSACTIONTYPE, REMARKS, USERNAME, SYSROWID, WORKERSERIAL, TOKENNO
   
   
   SELECT 
   COMPANYCODE, DIVISIONCODE,PFNO, TOKENNO,WORKERSERIAL, LOANCODE, LOANDATE, 
   0 ASONCAPITALBAL,0 ASONINTERESTBAL,INTERESTAPPLICABLEON SANCTIONAMOUNT,INTERESTAMOUNT INTERESTAMOUNT,1000 MERGELOANAMOUNT, 
   0 ADJINTERESTAMOUNT,0 ADJCAPITALAMOUNT,'07-SEP-2020' ADUJSTMENTDATE,'PF LOAN INTEREST ADJUSTMENT' REMARKS,SYSDATE LASTMODIEIED, 'SWT' USERNAME
   FROM PFLOANINTEREST A
   WHERE TOKENNO='84641'
   
   , 
   (
        SELECT PFNO, WORKERSERIAL FROM PFEMPLOYEEMASTER 
   ) B
   WHERE A.WORKERSERIAL=B.WORKERSERIAL
   
   
   SELECT A.TOKENNO, B.EMPLOYEENAME,  A.LOANCODE, TO_CHAR(A.LOANDATE,'DD/MM/YYYY') LOANDATE, 
   A.LOANAMOUNT, A.LOAN_BAL, NVL(C.INTERESTPERCENTAGE,0)  INTERESTPERCENTAGE , NVL(C.INTERESTAMOUNT,0) INTERESTAMOUNT
FROM GBL_PFLOANBLNC A, PISEMPLOYEEMASTER B, PFLOANINTEREST C
WHERE A.COMPANYCODE=B.COMPANYCODE
AND A.DIVISIONCODE=B.DIVISIONCODE
AND A.COMPANYCODE=C.COMPANYCODE(+)
AND A.DIVISIONCODE=C.DIVISIONCODE(+)
AND A.TOKENNO=C.TOKENNO(+)
AND A.LOANCODE=C.LOANCODE(+)
AND A.LOANDATE=C.LOANDATE(+)
AND A.TOKENNO=B.TOKENNO

PFLOAN_BAL, PFLOAN_INT_BAL

SELECT A.COMPANYCODE, A.DIVISIONCODE, A.PFNO,  A.TOKENNO, A.WORKERSERIAL,  A.LOANCODE,  A.LOANDATE, 
C.PFLOAN_BAL ASONCAPITALBAL,C.PFLOAN_INT_BAL ASONINTERESTBAL,INTERESTAPPLICABLEON SANCTIONAMOUNT,
INTERESTAMOUNT INTERESTAMOUNT,0 MERGELOANAMOUNT,    0 ADJINTERESTAMOUNT,0 ADJCAPITALAMOUNT,
'07-SEP-2020' ADUJSTMENTDATE,'PF LOAN INTEREST ADJUSTMENT' REMARKS,SYSDATE LASTMODIEIED, 'SWT' USERNAME
FROM PFLOANINTEREST A, PISEMPLOYEEMASTER B, GBL_PFLOANBLNC C
WHERE A.TOKENNO='84641'
AND A.COMPANYCODE=B.COMPANYCODE
AND A.DIVISIONCODE=B.DIVISIONCODE
AND A.TOKENNO=C.TOKENNO(+)
AND A.LOANCODE=C.LOANCODE(+)
AND A.LOANDATE=C.LOANDATE(+)
AND A.TOKENNO=B.TOKENNO

SQL.Append(" SELECT A.COMPANYCODE, A.DIVISIONCODE, A.PFNO,  A.TOKENNO, A.WORKERSERIAL,  A.LOANCODE,  A.LOANDATE,  ")
SQL.Append(" C.PFLOAN_BAL ASONCAPITALBAL,C.PFLOAN_INT_BAL ASONINTERESTBAL,INTERESTAPPLICABLEON SANCTIONAMOUNT, ")
SQL.Append(" INTERESTAMOUNT INTERESTAMOUNT,0 MERGELOANAMOUNT,    0 ADJINTERESTAMOUNT,0 ADJCAPITALAMOUNT, ")
SQL.Append(" '07-SEP-2020' ADUJSTMENTDATE,'PF LOAN INTEREST ADJUSTMENT' REMARKS,SYSDATE LASTMODIEIED, 'SWT' USERNAME ")
SQL.Append(" FROM PFLOANINTEREST A, PISEMPLOYEEMASTER B, GBL_PFLOANBLNC C ")
SQL.Append(" WHERE A.TOKENNO='84641' ")
SQL.Append(" AND A.COMPANYCODE=B.COMPANYCODE ")
SQL.Append(" AND A.DIVISIONCODE=B.DIVISIONCODE ")
SQL.Append(" AND A.TOKENNO=C.TOKENNO(+) ")
SQL.Append(" AND A.LOANCODE=C.LOANCODE(+) ")
SQL.Append(" AND A.LOANDATE=C.LOANDATE(+) ")
SQL.Append(" AND A.TOKENNO=B.TOKENNO ")


PROC_PFLOANBLNC



EXEC PROC_PFLOANBLNC('NJ0002','0010','07/09/2020','07/09/2020','MPL','P01247','PIS')

EXEC PROC_PFLOANBLNC('NJ0002','0010','07/09/2020','07/09/2020','MPL','','PIS')

SELECT * FROM GBL_PFLOANBLNC

SELECT * FROM PFLOANINTEREST WHERE TOKENNO='60394'

SELECT * FROM PFLOANTRANSACTION WHERE TOKENNO='60394' AND LOANCODE='MPL' AND LOANDATE='01-JUN-2020'


SELECT (13630-11230) FROM DUAL

13630

11230
P01247

  SELECT A.COMPANYCODE, A.DIVISIONCODE, A.PFNO,  A.TOKENNO, A.WORKERSERIAL,  A.LOANCODE,  A.LOANDATE,  
  C.PFLOAN_BAL ASONCAPITALBAL,C.PFLOAN_INT_BAL ASONINTERESTBAL,INTERESTAPPLICABLEON SANCTIONAMOUNT, 
  D.INTERESTAMOUNT INTERESTAMOUNT,D.LOANINTAMOUNTADJUSTED MERGELOANAMOUNT,(D.LOANINTAMOUNTADJUSTED+D.INTERESTAMOUNT) ADJINTERESTAMOUNT,0 ADJCAPITALAMOUNT, 
  NULL ADUJSTMENTDATE,'PF LOAN INTEREST ADJUSTMENT' REMARKS,SYSDATE LASTMODIEIED, 
  'SWT' USERNAME FROM PFLOANINTEREST A, PFEMPLOYEEMASTER B, GBL_PFLOANBLNC C , PFLOANTRANSACTION D 
  WHERE 1=1 
  AND A.COMPANYCODE=B.COMPANYCODE 
  AND A.DIVISIONCODE=B.DIVISIONCODE 
  AND A.TOKENNO=C.TOKENNO(+) 
  AND A.LOANCODE=C.LOANCODE(+) 
  AND A.LOANDATE=C.LOANDATE(+) 
  AND A.TOKENNO=D.TOKENNO(+) 
  AND A.LOANCODE=D.LOANCODE(+) 
  AND A.LOANDATE=D.LOANDATE(+) 
  AND A.TOKENNO=B.TOKENNO 
  AND A.LOANDATE= (SELECT MAX(LOANDATE) FROM PFLOANINTEREST WHERE WORKERSERIAL=A.WORKERSERIAL AND LOANCODE='MPL')
AND A.LOANCODE= 'MPL'
AND B.CATEGORYCODE = 'B'
AND B.GRADECODE = '115A'
AND B.TOKENNO = '60394'
ORDER BY B.TOKENNO  


---------------------------------------------------------------------------
---------------------------------------------------------------------------
--ACTUAL LOAN DATE UPDATE AS PER REQUEST FROM KAMLESH RAO
---------------------------------------------------------------------------


SELECT PFNO, TOKENNO from PFLOANTRANSACTION 
WHERE PFNO IN ('M01388',
'M01376',
'MO1227',
'MO1404',
'MO1407',
'MO1426',
'MO1395',
'M01394',
'MO1459',
'MO1422',
'MO1445',
'MO1337')

SELECT LOANDATE,ACTUALLOANDATE FROM PFLOANTRANSACTION
WHERE TOKENNO  IN ( --'71483','71482','75099','71468')
'75099',
'71468',
'71335',
'70180',
'71496',
'71515',
'71483',
'71482',
'71544',
'71511',
'71533',
'70162'
)
AND LOANDATE='01-JUL-2020'


AND LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') 



UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='75099'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY'); 
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71468'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71335'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='70180'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71496'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71515'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71483'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71482'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('08/06/2020','DD/MM/YYYY') WHERE TOKENNO='71544'AND  LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') ;
--UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('22/06/2020','DD/MM/YYYY') WHERE TOKENNO='71511'AND  PFNO='MO1422' AND LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') 
--UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('22/06/2020','DD/MM/YYYY') WHERE TOKENNO='71533'AND  PFNO='MO1445' AND LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') 
--UPDATE PFLOANTRANSACTION SET ACTUALLOANDATE=TO_DATE('26/06/2020','DD/MM/YYYY') WHERE TOKENNO='70162'AND  PFNO='MO1337' AND LOANDATE=TO_DATE('01/07/2020','DD/MM/YYYY') 



SELECT LOANDESC||'~'||INTERESTPERCENTAGE FROM pfLOANMASTER WHERE COMPANYCODE = 'NJ0002' AND DIVISIONCODE = '0010' AND LOANCODE = 'MPL' 



SELECT PFNO ,WORKERSERIAL,NVL(TOKENNO,'XXXXX') TOKENNO,NVL(EMPLOYEENAME,'XXXXXX') EMPLOYEENAME,UNITCODE, CATEGORYCODE, GRADECODE,
MODULE PROJNAME FROM PFEMPLOYEEMASTER 
WHERE COMPANYCODE = 'NJ0002'
AND DIVISIONCODE = '0010'
AND PFNO = 'WS1546'
AND EMPLOYEESTATUS = 'ACTIVE' AND ROWNUM=1 ORDER BY TOKENNO


-----------------------------------------------------------------------------
 