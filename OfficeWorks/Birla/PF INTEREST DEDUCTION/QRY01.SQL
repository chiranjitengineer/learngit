
----------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------

 CREATE TABLE PIS_SWT_PHASE_DEDN AS 
 
 SELECT PISTEMPATTN.COMPANYCODE, PISTEMPATTN.DIVISIONCODE,PISTEMPATTN.YEARMONTH, PISTEMPATTN.UNITCODE, PISTEMPATTN.CATEGORYCODE, PISTEMPATTN.GRADECODE, PISTEMPATTN.WORKERSERIAL, PISTEMPATTN.TOKENNO, PISTEMPCOMP.ATTN_SALD, PISTEMPCOMP.ATTN_CALCF, 
 PISTEMPCOMP.GROSSEARN, PISTEMPCOMP.TOTEARN 
 , FN_ROUNDOFFRS(NVL(PISTEMPATTN.CAR,0),1,'N') AS CAR, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.CHOWKIDARI,0),1,'N') AS CHOWKIDARI, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.UNITCODE='01' AND   PISTEMPMAST.TOKENNO<>'01207' AND  (PISTEMPMAST.CATEGORYCODE='10' OR PISTEMPMAST.CATEGORYCODE='11') THEN CASE WHEN PISTEMPASSIGN.BASIC < 2000 THEN 5 WHEN PISTEMPASSIGN.BASIC BETWEEN 2000 AND 2999 THEN 8 WHEN PISTEMPASSIGN.BASIC BETWEEN 3000 AND 7499 THEN 10 ELSE 15 END END,1,'N') AS CLUB, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.PFAPPLICABLE ='Y' AND ((PISTEMPMAST.CATEGORYCODE IN('10','11') AND PISTEMPMAST.UNITCODE = '01') OR (PISTEMPMAST.TOKENNO='01069')) THEN CASE WHEN PISTEMPCOMP.BASIC <= 10000 THEN 200 ELSE 500 END ELSE 0 END,1,'N') AS COMPSAVING, FN_ROUNDOFFRS(NVL(PISTEMPATTN.DAIRY,0),1,'N') AS DAIRY, FN_ROUNDOFFRS(0,1,'N') AS ELECTRIC, FN_ROUNDOFFRS(CASE WHEN PISTEMPCOMP.ESI_RATE > 21000 THEN  0 ELSE PISTEMPCOMP.ESI_GROSS*0.0075  END,1,'H') AS ESI_E, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.FURNITURE,0),1,'N') AS FURNITURE, FN_ROUNDOFFRS(NVL(PISTEMPATTN.GAMES,0),1,'N') AS GAMES, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.HR_DEDN,0),1,'N') AS HR_DEDN, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.ITAX,0),1,'N') AS ITAX, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.LADIESCLUB,0),1,'S') AS LADIESCLUB, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.UNITCODE='01' AND  PISTEMPMAST.TOKENNO<>'01207' AND  PISTEMPMAST.CATEGORYCODE IN ('10','11') THEN (PISTEMPCOMP.BASIC+ PISTEMPCOMP.DA)*0.001 ELSE 0 END,1,'S') AS LIBRARY, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.LIC,0),1,'N') AS LIC,  0  AS LINT_BL,  0  AS LINT_HPF,  0  AS LINT_PFL,  0  AS LINT_SA,  0  AS LINT_STADV,  0  AS LOAN_BL,  0  AS LOAN_HPF,  0  AS LOAN_PFL,  0  AS LOAN_SA,  0  AS LOAN_STADV, FN_ROUNDOFFRS(NVL(PISTEMPATTN.LOTTERY,0),1,'N') AS LOTTERY, FN_ROUNDOFFRS(CASE WHEN SUBSTR(PISTEMPCOMP.YEARMONTH,-2) IN ('06','12') THEN 3 ELSE 0 END,1,'N') AS LWF, FN_ROUNDOFFRS(NVL(PISTEMPATTN.OTHR_DEDN,0),1,'N') AS OTHR_DEDN, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.PFAPPLICABLE ='Y' THEN CASE WHEN  PISTEMPMAST.UNITCODE='03' AND PISTEMPMAST.CATEGORYCODE='23' THEN PISTEMPCOMP.PF_GROSS*0.10 ELSE  PISTEMPCOMP.PF_GROSS*0.12  END ELSE 0 END,1,'S') AS PF_E, FN_ROUNDOFFRS(PISTEMPCOMP.PTAX_GROSS,1,'N') AS PTAX, FN_ROUNDOFFRS(NVL(PISTEMPATTN.RECREATION,0),1,'N') AS RECREATION, FN_ROUNDOFFRS(NVL(PISTEMPATTN.SAL_ADV,0),1,'N') AS SAL_ADV, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.SCHOOL_BUS,0),1,'N') AS SCHOOL_BUS, FN_ROUNDOFFRS(NVL(PISTEMPATTN.SUBSCRIPTION,0),1,'N') AS SUBSCRIPTION, FN_ROUNDOFFRS((PISTEMPCOMP.PF_GROSS*0.01*PISTEMPASSIGN.VPF_PERC),1,'S') AS VPF 
 FROM PISTEMPMAST, PISTEMPATTN, PISTEMPASSIGN, PISTEMPCOMP, PISTEMPPREV 
 WHERE PISTEMPMAST.WORKERSERIAL = PISTEMPATTN.WORKERSERIAL (+)
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPASSIGN.WORKERSERIAL (+)
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPCOMP.WORKERSERIAL (+)
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPPREV.WORKERSERIAL (+) 
 AND PISTEMPATTN.CATEGORYCODE = '10' 
 AND PISTEMPATTN.GRADECODE = 'C' 
 AND PISTEMPATTN.WORKERSERIAL = ' 000166' 
 
 
 
 SELECT * FROM PISTEMPMAST
 WHERE WORKERSERIAL = ' 000166' 
 
 SELECT * FROM PISEMPLOYEEMASTER
 WHERE WORKERSERIAL = ' 000166' 
 
 SELECT * FROM PISTEMPATTN
 WHERE WORKERSERIAL = ' 000166' 
 
 
----------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------

 INSERT INTO GBL_PFLOANBLNC 
 
 SELECT B.WORKERSERIAL, B.TOKENNO, A.PFNO, A.LOANCODE, A.LOANDATE, SUM(A.AMOUNT) PFLOAN_BAL, 
CASE WHEN SUM(INTERESTAMOUNT) > 0 THEN SUM(INTERESTAMOUNT) ELSE 0 END PFLOAN_INT_BAL, 
 SUM(LN_CAP_DEDUCT) PFLN_CAP_DEDUCT, SUM(LN_INT_DEDUCT) PFLN_INT_DEDUCT,  
 /*NVL(X.CAP_EMI,0) CAP_EMI, NVL(X.INT_EMI,0) INT_EMI, */
 CASE WHEN M.DEDUCTIONTYPE = 'DEDUCT INTEREST FULL THEN CAPITAL' AND SUM(INTERESTAMOUNT) > 0 THEN 0 ELSE DECODE(DEDUCTIONTYPE,'DEDUCT CAPITAL AND INTEREST SAMETIME',NVL(X.CAP_EMI,0),NVL(X.TOT_EMI,0)) END CAP_EMI, 
 CASE WHEN M.DEDUCTIONTYPE = 'DEDUCT CAPITAL FULL THEN INTEREST' AND SUM(A.AMOUNT) >0 THEN 0 ELSE DECODE(DEDUCTIONTYPE,'DEDUCT CAPITAL AND INTEREST SAMETIME',NVL(X.INT_EMI,0),NVL(X.TOT_EMI,0))  END INT_EMI, 
 NVL(X.TOT_EMI,0) TOT_EMI, NVL(STP.CAPITAL,'N') CAP_STOP, NVL(STP.INTEREST,'N') INT_STOP, 
 M.CAP_EMI_DEDUCT_TYPE, M.INT_EMI_DEDUCT_TYPE, B.MODULE 
 FROM (  
         SELECT DISTINCT A.PFNO, A.LOANCODE, A.LOANDATE, AMOUNT, 0 INTERESTAMOUNT , 0 LN_CAP_DEDUCT, 0 LN_INT_DEDUCT 
         FROM PFLOANTRANSACTION A,  PFMAXLOANDATE B 
         WHERE A.PFNO = B.PFNO AND A.LOANCODE = B.LOANCODE AND A.LOANDATE = B.LOANDATE  AND AMOUNT > 0 
         UNION ALL     
         SELECT A.PFNO, A.LOANCODE, A.LOANDATE,   
           (CASE WHEN TRANSACTIONTYPE ='CAPITAL' THEN AMOUNT  
                WHEN TRANSACTIONTYPE ='REPAY' THEN REPAYCAPITAL  
                WHEN TRANSACTIONTYPE ='REPAYCAP' THEN AMOUNT  
                ELSE 0  
           END)*(-1) AMOUNT, 0 INTERESTAMOUNT 
           , 0 LN_CAP_DEDUCT, 0 LN_INT_DEDUCT     
         FROM PFLOANBREAKUP A,  PFMAXLOANDATE B 
         WHERE A.PFNO = B.PFNO AND A.LOANCODE = B.LOANCODE AND A.LOANDATE = B.LOANDATE  
         AND A.EFFECTFORTNIGHT <=  TO_DATE('31/05/2020','DD/MM/YYYY')  
         AND TRANSACTIONTYPE <> 'INTEREST'  
         UNION ALL  
         SELECT DISTINCT C.PFNO, C.LOANCODE, C.LOANDATE, 0 AMOUNT, SUM(NVL(C.INTERESTAMOUNT,0)) INTERESTAMOUNT 
         , 0 LN_CAP_DEDUCT, 0 LN_INT_DEDUCT  
         FROM PFMAXLOANDATE B, PFLOANINTEREST C  
         WHERE B.PFNO = C.PFNO AND B.LOANCODE = C.LOANCODE AND B.LOANDATE = C.LOANDATE 
         AND C.FORTNIGHTENDDATE <= TO_DATE('31/05/2020','DD/MM/YYYY') 
         AND C.TRANSACTIONTYPE = 'ADD'  
         GROUP BY C.PFNO, C.LOANCODE, C.LOANDATE  
         UNION ALL  
         SELECT A.PFNO, A.LOANCODE, A.LOANDATE, 0 AMOUNT,   
           (CASE WHEN TRANSACTIONTYPE ='INTEREST' THEN AMOUNT  
                WHEN TRANSACTIONTYPE ='REPAY' THEN REPAYINTEREST  
                WHEN TRANSACTIONTYPE ='REPAYINT' THEN AMOUNT  
                ELSE 0  
           END)*(-1) INTERESTAMOUNT 
           , 0 LN_CAP_DEDUCT, 0 LN_INT_DEDUCT      
         FROM PFLOANBREAKUP A,  PFMAXLOANDATE B 
         WHERE A.PFNO = B.PFNO AND A.LOANDATE = B.LOANDATE  
         AND A.EFFECTFORTNIGHT <=  TO_DATE('31/05/2020','DD/MM/YYYY')  
         AND TRANSACTIONTYPE <> 'CAPITAL' 
         UNION ALL 
         SELECT A.PFNO, A.LOANCODE, A.LOANDATE, 0 AMOUNT,  0 INTERESTAMOUNT,  
         DECODE(TRANSACTIONTYPE,'CAPITAL',AMOUNT,0) LN_CAP_DEDUCT, DECODE(TRANSACTIONTYPE,'INTEREST',AMOUNT,0) LN_INT_DEDUCT 
         FROM PFLOANBREAKUP A,  PFMAXLOANDATE B 
         WHERE A.PFNO = B.PFNO AND A.LOANDATE = B.LOANDATE  
         AND A.EFFECTFORTNIGHT <= TO_DATE('31/05/2020','DD/MM/YYYY')
         AND TRANSACTIONTYPE IN ('CAPITAL','INTEREST')  
     ) A, PFEMPLOYEEMASTER B, 
     (  
        SELECT M.PFNO, M.LOANDATE,  
        NVL(M.CAPITALINSTALLMENTAMT,0) CAP_EMI,  
        NVL(M.INTERESTINSTALLMENTAMT,0) INT_EMI, NVL(M.TOTALEMIAMOUNT,0) TOT_EMI  
        FROM PFLOANTRANSACTION M, ( SELECT PFNO, MAX(LOANDATE) LOANDATE  
                                  FROM PFLOANTRANSACTION  
                                  WHERE 1=1 
                                    AND LOANDATE <= TO_DATE('31/05/2020','DD/MM/YYYY')  
                                    AND LOANTYPE ='REFUNDABLE'
                                  GROUP BY PFNO  
                                ) N   
        WHERE M.PFNO = N.PFNO AND M.LOANDATE = N.LOANDATE  AND M.LOANCODE='PFL' 
     )  X,   
     ( 
        SELECT DISTINCT LOANCODE, DEDUCTIONTYPE, 
        NVL(CAP_EMI_DEDUCT_TYPE,'PARTIAL') CAP_EMI_DEDUCT_TYPE, NVL(INT_EMI_DEDUCT_TYPE,'PARTIAL') INT_EMI_DEDUCT_TYPE  
        FROM PFLOANMASTER WHERE REFUNDTYPE ='REFUNDABLE' 
     ) M, 
     ( 
        SELECT WORKERSERIAL, TOKENNO, PFNO,LOANCODE, LOANSTOPFROMDATE, LOANSTOPTODATE, FULLMILL, CAPITAL, INTEREST 
        FROM PFLOANDEDUCTIONSTOP 
        WHERE LOANSTOPFROMDATE <= TO_DATE('31/05/2020','DD/MM/YYYY') AND LOANSTOPTODATE >= TO_DATE('31/05/2020','DD/MM/YYYY') 
     ) STP 
 WHERE A.PFNO = B.PFNO  
   AND A.PFNO = X.PFNO AND A.LOANDATE = X.LOANDATE 
   AND A.LOANCODE = M.LOANCODE 
AND A.PFNO  = STP.PFNO (+) 
 AND A.PFNO IN ( '12130')  
  GROUP BY B.WORKERSERIAL, B.TOKENNO, A.PFNO, A.LOANCODE, A.LOANDATE 
  ,NVL(X.CAP_EMI,0), NVL(X.INT_EMI,0), NVL(X.TOT_EMI,0), B.MODULE, 
  STP.CAPITAL, STP.INTEREST,STP.LOANCODE, M.DEDUCTIONTYPE, M.CAP_EMI_DEDUCT_TYPE, M.INT_EMI_DEDUCT_TYPE
  
  
----------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------


CAPITALINSTALLMENTAMOUNT

INTERESTINSTALLMENTAMOUNT

CAPITALINSTALLMENTAMT

INTERESTINSTALLMENTAMT

SELECT * FROM PFLOANTRANSACTION
WHERE CAPITALINSTALLMENTAMOUNT > 0 AND CAPITALINSTALLMENTAMT=0


SELECT * FROM PFLOANTRANSACTION
WHERE CAPITALINSTALLMENTAMOUNT > 0

UPDATE PFLOANTRANSACTION SET CAPITALINSTALLMENTAMT=CAPITALINSTALLMENTAMOUNT, INTERESTINSTALLMENTAMT=INTERESTINSTALLMENTAMOUNT
WHERE CAPITALINSTALLMENTAMOUNT > 0 AND CAPITALINSTALLMENTAMT=0

UPDATE PFLOANAPPLICATION SET CAPITALINSTALLMENTAMT=CAPITALINSTALLMENTAMOUNT, INTERESTINSTALLMENTAMT=INTERESTINSTALLMENTAMOUNT
WHERE CAPITALINSTALLMENTAMOUNT > 0 AND CAPITALINSTALLMENTAMT=0


select * from gbl_pfloanblnc WHERE TOKENNO='00944'

exec proc_pfloanblnc('BJ0056','0001','01/05/2020','31/05/2020','PFL','11444','PIS','NO')

exec proc_PFloanblnc('BJ0056','0001','01/05/2020','31/05/2020','PFL','12130','PIS','NO')

SELECT * FROM PISEMPLOYEEMASTER
WHERE TOKENNO='00944'



DELETE FROM PIS_ERROR_LOG

SELECT * FROM PIS_ERROR_LOG

WHERE ORA_ERROR_MESSG IS NOT NULL

PRC_PISSALARY_OTHCOMP_UPDATE

 EXEC  PRC_PIS_SALARY_PROCESS('BJ0056','0001','SALARY','SWT','202005','202005','01','10','D','',' 000166');
 
 PRC_PISSALARYPROCESS_DEDN
 
 EXEC  PRC_PIS_PHASE_DEDN_ROWISE('BJ0056','0001', '202005','PIS_SWT_PHASE_DEDN',6 ); 
 
 
  CREATE TABLE PIS_SWT_PHASE_DEDN AS 

 SELECT PISTEMPATTN.COMPANYCODE, PISTEMPATTN.DIVISIONCODE,PISTEMPATTN.YEARMONTH, PISTEMPATTN.UNITCODE, PISTEMPATTN.CATEGORYCODE, PISTEMPATTN.GRADECODE, PISTEMPATTN.WORKERSERIAL, PISTEMPATTN.TOKENNO, PISTEMPCOMP.ATTN_SALD, PISTEMPCOMP.ATTN_CALCF, 
 PISTEMPCOMP.GROSSEARN, PISTEMPCOMP.TOTEARN 
 , FN_ROUNDOFFRS(NVL(PISTEMPATTN.CAR,0),1,'N') AS CAR, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.CHOWKIDARI,0),1,'N') AS CHOWKIDARI, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.UNITCODE='01' AND   PISTEMPMAST.TOKENNO<>'01207' AND  (PISTEMPMAST.CATEGORYCODE='10' OR PISTEMPMAST.CATEGORYCODE='11') THEN CASE WHEN PISTEMPASSIGN.BASIC < 2000 THEN 5 WHEN PISTEMPASSIGN.BASIC BETWEEN 2000 AND 2999 THEN 8 WHEN PISTEMPASSIGN.BASIC BETWEEN 3000 AND 7499 THEN 10 ELSE 15 END END,1,'N') AS CLUB, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.PFAPPLICABLE ='Y' AND ((PISTEMPMAST.CATEGORYCODE IN('10','11') AND PISTEMPMAST.UNITCODE = '01') OR (PISTEMPMAST.TOKENNO='01069')) THEN CASE WHEN PISTEMPCOMP.BASIC <= 10000 THEN 200 ELSE 500 END ELSE 0 END,1,'N') AS COMPSAVING, FN_ROUNDOFFRS(NVL(PISTEMPATTN.DAIRY,0),1,'N') AS DAIRY, FN_ROUNDOFFRS(0,1,'N') AS ELECTRIC, FN_ROUNDOFFRS(CASE WHEN PISTEMPCOMP.ESI_RATE > 21000 THEN  0 ELSE PISTEMPCOMP.ESI_GROSS*0.0075  END,1,'H') AS ESI_E, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.FURNITURE,0),1,'N') AS FURNITURE, FN_ROUNDOFFRS(NVL(PISTEMPATTN.GAMES,0),1,'N') AS GAMES, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.HR_DEDN,0),1,'N') AS HR_DEDN, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.ITAX,0),1,'N') AS ITAX, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.LADIESCLUB,0),1,'S') AS LADIESCLUB, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.UNITCODE='01' AND  PISTEMPMAST.TOKENNO<>'01207' AND  PISTEMPMAST.CATEGORYCODE IN ('10','11') THEN (PISTEMPCOMP.BASIC+ PISTEMPCOMP.DA)*0.001 ELSE 0 END,1,'S') AS LIBRARY, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.LIC,0),1,'N') AS LIC,  0  AS LINT_BL,  0  AS LINT_HPF,  0  AS LINT_PFL,  0  AS LINT_SA,  0  AS LINT_STADV,  0  AS LOAN_BL,  0  AS LOAN_HPF,  0  AS LOAN_PFL,  0  AS LOAN_SA,  0  AS LOAN_STADV, FN_ROUNDOFFRS(NVL(PISTEMPATTN.LOTTERY,0),1,'N') AS LOTTERY, FN_ROUNDOFFRS(CASE WHEN SUBSTR(PISTEMPCOMP.YEARMONTH,-2) IN ('06','12') THEN 3 ELSE 0 END,1,'N') AS LWF, FN_ROUNDOFFRS(NVL(PISTEMPATTN.OTHR_DEDN,0),1,'N') AS OTHR_DEDN, FN_ROUNDOFFRS(CASE WHEN PISTEMPMAST.PFAPPLICABLE ='Y' THEN CASE WHEN  PISTEMPMAST.UNITCODE='03' AND PISTEMPMAST.CATEGORYCODE='23' THEN PISTEMPCOMP.PF_GROSS*0.10 ELSE  PISTEMPCOMP.PF_GROSS*0.12  END ELSE 0 END,1,'S') AS PF_E, FN_ROUNDOFFRS(PISTEMPCOMP.PTAX_GROSS,1,'N') AS PTAX, FN_ROUNDOFFRS(NVL(PISTEMPATTN.RECREATION,0),1,'N') AS RECREATION, FN_ROUNDOFFRS(NVL(PISTEMPATTN.SAL_ADV,0),1,'N') AS SAL_ADV, FN_ROUNDOFFRS(NVL(PISTEMPASSIGN.SCHOOL_BUS,0),1,'N') AS SCHOOL_BUS, FN_ROUNDOFFRS(NVL(PISTEMPATTN.SUBSCRIPTION,0),1,'N') AS SUBSCRIPTION, FN_ROUNDOFFRS((PISTEMPCOMP.PF_GROSS*0.01*PISTEMPASSIGN.VPF_PERC),1,'S') AS VPF 
 FROM PISTEMPMAST, PISTEMPATTN, PISTEMPASSIGN, PISTEMPCOMP, PISTEMPPREV 
 WHERE PISTEMPMAST.WORKERSERIAL = PISTEMPATTN.WORKERSERIAL 
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPASSIGN.WORKERSERIAL 
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPCOMP.WORKERSERIAL 
   AND PISTEMPMAST.WORKERSERIAL = PISTEMPPREV.WORKERSERIAL (+) 
 AND PISTEMPATTN.CATEGORYCODE = '10' 
 AND PISTEMPATTN.GRADECODE = 'C' 
 AND PISTEMPATTN.DEPARTMENTCODE = ' 000041' 
 
SELECT CASE WHEN PFLOAN_INT_BAL > INT_EMI THEN INT_EMI ELSE PFLOAN_INT_BAL END,
CASE WHEN PFLOAN_BAL > CAP_EMI THEN CAP_EMI ELSE PFLOAN_BAL END,
CASE WHEN PFLOAN_INT_BAL > INT_EMI THEN INT_EMI ELSE PFLOAN_INT_BAL END 
--INTO lv_ComponentAmt, lv_CapEMI, lv_IntEMI
--SELECT CASE WHEN PFLOAN_INT_BAL > INT_EMI THEN INT_EMI ELSE PFLOAN_INT_BAL END INTO lv_ComponentAmt  
FROM GBL_PFLOANBLNC
-- ADD 14/09/2019 
--WHERE WORKERSERIAL = cWages.WorkerSerial
WHERE PFNO = '12130'
-- ADD 14/09/2019
AND LOANCODE = 'PFL' --substr(cWages.componentcode,6)
AND NVL(INT_STOP,'N') = 'N'
AND PFLOAN_INT_BAL > 0;

tokenno in ('00473','00944')

tokenno in ('00473','00944')

SELECT * FROM PFLOANINTEREST

fn_getFortnightStartEndDate(LOANDATE,'START')


FN_GET

SELECT * FROM PFLOANMASTER

INSERT INTO PFLOANINTEREST
(
COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, FORTNIGHTSTARTDATE, FORTNIGHTENDDATE, PFNO, LOANCODE, LOANDATE, LOANAMOUNT, INTERESTAPPLICABLEON, INTERESTPERCENTAGE, INTERESTAMOUNT, EMPLOYEECOMPANYCODE, EMPLOYEEDIVISIONCODE, MODULE, TRANSACTIONTYPE, REMARKS, USERNAME, SYSROWID, WORKERSERIAL, TOKENNO
)
SELECT * FROM (
SELECT 
COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH,TO_DATE(fn_getFortnightStartEndDate(LOANDATE,'START'),'DD/MM/YYYY') FORTNIGHTSTARTDATE,TO_DATE(fn_getFortnightStartEndDate(LOANDATE,'END'),'DD/MM/YYYY') FORTNIGHTENDDATE, 
PFNO, LOANCODE, LOANDATE,LOANCLAIMAMOUNT LOANAMOUNT, LOANCLAIMAMOUNT INTERESTAPPLICABLEON, INTERESTPERCENTAGE, INTERESTAMOUNT, 
EMPLOYEECOMPANYCODE, EMPLOYEEDIVISIONCODE, MODULE, 'ADD' TRANSACTIONTYPE,'DATA MIGRATION FROM INSERT SCRIPT ON 24-APR-2020' REMARKS, USERNAME,SYS_GUID() SYSROWID, WORKERSERIAL, TOKENNO
FROM PFLOANTRANSACTION
)

SELECT INTERESTPERCENTAGE FROM PFLOANTRANSACTION

UPDATE PFLOANTRANSACTION SET INTERESTPERCENTAGE = 8



SELECT   column_name cn
FROM   cols
WHERE   table_name = 'PIS_SWT_PHASE_DEDN'           --'SWT_PHASE_DEDN'
INTERSECT
SELECT   COMPONENTCODE cn
FROM   PISCOMPONENTMASTER
WHERE       COMPANYCODE = 'BJ0056'
AND DIVISIONCODE = '0001'
AND COMPONENTCODE <> 'GROSSEARN'
AND YEARMONTH =
(SELECT   MAX (YEARMONTH)
FROM   PISCOMPONENTMASTER
WHERE       COMPANYCODE = 'BJ0056'
AND DIVISIONCODE = '0001'
AND YEARMONTH <= '202005')
AND PHASE = 6


----------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------