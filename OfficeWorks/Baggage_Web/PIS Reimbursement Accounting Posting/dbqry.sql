PRC_PISSALARY_POSTINGDATA
PRCPIS_POST_TO_ACC

PROC_REIMBURSEMENT




select SUM(PAIDAMOUNT) from pisreimbursementdetails
WHERE COMPONENTCODE='LTA'
AND YEARMONTH='202004'

select * from piscomponentmaster where componentcode='LTA'


select COMPONENTCODE,ACCCODE,SUBCODE,EXPENCECODE from piscomponentmaster where componentcode='LTA'


EXEC prc_pissalary_postingdata('0001','001','REIMBURSEMENT PROCESS','202004','001','02','')

SELECT * FROM PISSALARY_POSTINGDATA


EXEC prcpis_post_to_acc('0001','001','REIMBURSEMENT PROCESS','202004','001','','','')

SELECT * FROM SYS_AUTOGEN_PARAMS
WHERE PARAM_NAME = 'AC_SYS_VOUCHERNO_PIS_STAFF_ARR'

AC_SYS_VOUCHERNO_PIS_STAFF_ARR

AC_VOUCHERNO_PIS_STAFF_ARR


001/PIS/M/RIM/20-21/00001

001/PIS/M/RIM/20-21/00001

001/PIS/RIM/2021/00001

SELECT * FROM ACVOUCHER

SELECT * FROM acvoucherdetails_entry WHERE SYSTEMVOUCHERNO='001/PIS/M/RIM/20-21/00001'

 EXEC  prc_delete_systemvoucher('0001','001','2020-2021','001/PIS/M/RIM/20-21/00001','FORCED');
 
 
EXEC PROC_REIMBURSEMENT('0001','001','2020-2021','202004','001','02','CIV','','FIX_CONV','','1','A','N')
 
SELECT * FROM GTT_PISREIMBURSEMENT

SELECT * FROM JSWRAPPER

SELECT * FROM PISCOMPONENTMASTER
WHERE ALLOWREIMBURSEMENT='Y'


sys_tfmap

exec proc_create_gbl_tmp_tables(10011,0)


--------------------------------------------------------------------------

1. CREATE OR REPLACE VIEW VW_PISCOMPONENTLEDGERMAPPING 
 AS 
 SELECT COMPANYCODE, DIVISIONCODE, QUALITY_GROUP_CODE as COMPONENTCODE,  ACCODE ACCCODE 
 FROM SYS_PARAM_ACPOST_PAYROLL 
 WHERE COMPANYCODE = '0001' AND DIVISIONCODE = '001' 
 AND  POSTING_PARAM_NAME = 'PIS SALARY POSTING TO ACCOUNTS' 
 AND  MODULENAME = 'PIS' 


INSERT INTO PISSALARY_POSTINGDATA 
( 
  COMPANYCODE, DIVISIONCODE, PERIODFROM, PERIODTO, ACCODE, ACHEAD, DRCR, AMOUNT, ACCOSTCENTRECODE, CATEGORYCODE, UNITCODE, GRADECODE 
) 


SELECT D.COMPANYCODE,D.DIVISIONCODE, 
       TO_DATE('01/08/2020','DD/MM/YYYY') PERIODFROM,TO_DATE('31/08/2020','DD/MM/YYYY') PERIODTO, 
       C.ACCCODE, B.ACHEAD, 
       CASE                                                
            WHEN D.COMPONENTCODE = 'NETSALARY' THEN 'CR' 
            WHEN C.ACCCODE IN (SELECT DISTINCT EXPENSECODE FROM PISCOMPONENTMASTER ) THEN 'CR' 
            WHEN C.ACCCODE IN (SELECT DISTINCT ACCCODE FROM PISCOMPONENTMASTER WHERE COMPONENTCODE IN ('PF_C','FPF')) THEN 'CR' 
            WHEN D.COMPONENTTYPE = 'EARNING' THEN 'DR' 
            WHEN D.COMPONENTTYPE = 'DEDUCTION' THEN 'CR' 
            ELSE 'DR' 
        END AS DRCR, 
       FN_PISSALARY_COMP_AMT(C.COMPANYCODE,C.DIVISIONCODE,'SALARY PROCESS',C.COMPONENTCODE, '202008' , '02' , '001' , '')  AMOUNT, 
       NULL ACCOSTCENTRECODE, '02' CATEGORYCODE, '001' UNITCODE, '' GRADECODE 
  FROM PISCOMPONENTMASTER D, 
        ( 
          SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, ACCCODE 
            FROM VW_PISCOMPONENTLEDGERMAPPING 
           WHERE COMPANYCODE = '0001' 
             AND DIVISIONCODE = '001' 
             UNION ALL
          SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, EXPENSECODE 
            FROM PISCOMPONENTMASTER 
           WHERE COMPANYCODE = '0001' 
             AND DIVISIONCODE = '001' 
        ) C ,ACACLEDGER B 
 WHERE C.COMPANYCODE = '0001' 
   AND C.DIVISIONCODE = '001' 
   AND C.COMPANYCODE = D.COMPANYCODE 
   AND C.DIVISIONCODE = D.DIVISIONCODE 
   AND C.COMPONENTCODE=D.COMPONENTCODE 
   AND B.COMPANYCODE = C.COMPANYCODE 
   AND B.ACCODE = C.ACCCODE

INSERT INTO PISSALARY_POSTINGDATA_CC 
( 
  COMPANYCODE, DIVISIONCODE, PERIODFROM, PERIODTO, ACCODE, ACHEAD, DRCR, AMOUNT, ACCOSTCENTRECODE, CATEGORYCODE, UNITCODE, GRADECODE  
) 
SELECT D.COMPANYCODE,D.DIVISIONCODE, 
       TO_DATE('01/08/2020','DD/MM/YYYY') PERIODFROM,TO_DATE('31/08/2020','DD/MM/YYYY') PERIODTO, 
       C.ACCCODE, B.ACHEAD, 
       CASE  
            WHEN D.COMPONENTCODE = 'NETSALARY' THEN 'CR' 
            WHEN C.ACCCODE IN (SELECT DISTINCT EXPENSECODE FROM PISCOMPONENTMASTER ) THEN 'CR' 
            WHEN C.ACCCODE IN (SELECT DISTINCT ACCCODE FROM PISCOMPONENTMASTER WHERE COMPONENTCODE IN ('PF_C','FPF')) THEN 'CR' 
            WHEN D.COMPONENTTYPE = 'EARNING' THEN 'DR' 
            WHEN D.COMPONENTTYPE = 'DEDUCTION' THEN 'CR' 
            ELSE 'DR' 
        END AS DRCR, 
       FN_PISSALARY_COMP_AMT_CC(C.COMPANYCODE,C.DIVISIONCODE,'SALARY PROCESS',C.COMPONENTCODE, '202008' , '02' , '001' , '',PT.WORKERSERIAL)  AMOUNT, 
       X.COSTCENTRECODE ACCOSTCENTRECODE, '02' CATEGORYCODE, '001' UNITCODE , '' GRADECODE 
  FROM PISCOMPONENTMASTER D, PISPAYTRANSACTION PT, PISEMPLOYEEMASTER X,
        ( 
          SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, ACCCODE 
            FROM VW_PISCOMPONENTLEDGERMAPPING 
           WHERE COMPANYCODE = '0001' 
             AND DIVISIONCODE = '001' 
             UNION ALL
          SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, EXPENSECODE 
            FROM PISCOMPONENTMASTER 
           WHERE COMPANYCODE = '0001' 
             AND DIVISIONCODE = '001' 
        ) C ,ACACLEDGER B 
 WHERE C.COMPANYCODE = '0001' 
   AND C.DIVISIONCODE = '001' 
   AND C.COMPANYCODE = D.COMPANYCODE 
   AND C.DIVISIONCODE = D.DIVISIONCODE 
   AND C.COMPONENTCODE=D.COMPONENTCODE 
   AND B.COMPANYCODE = C.COMPANYCODE 
   AND B.ACCODE = C.ACCCODE 
   AND C.COMPANYCODE = PT.COMPANYCODE 
   AND C.DIVISIONCODE = PT.DIVISIONCODE 
   AND PT.YEARMONTH = '202008' 
   AND PT.CATEGORYCODE = '02' 
   AND PT.COMPANYCODE = X.COMPANYCODE 
   AND PT.DIVISIONCODE = X.DIVISIONCODE 
   AND PT.WORKERSERIAL = X.WORKERSERIAL


-----------------------------------------------------------------------------


SELECT D.COMPANYCODE,D.DIVISIONCODE, D.COMPONENTCODE,
TO_DATE('01/08/2020','DD/MM/YYYY') PERIODFROM,TO_DATE('31/08/2020','DD/MM/YYYY') PERIODTO, 
C.ACCCODE, B.ACHEAD, 
CASE                                                
    WHEN D.COMPONENTCODE = 'NETSALARY' THEN 'CR' 
    WHEN C.ACCCODE IN (SELECT DISTINCT EXPENSECODE FROM PISCOMPONENTMASTER ) THEN 'CR' 
    WHEN C.ACCCODE IN (SELECT DISTINCT ACCCODE FROM PISCOMPONENTMASTER WHERE COMPONENTCODE IN ('PF_C','FPF')) THEN 'CR' 
    WHEN D.COMPONENTTYPE = 'EARNING' THEN 'DR' 
    WHEN D.COMPONENTTYPE = 'DEDUCTION' THEN 'CR' 
ELSE 'DR' 
END AS DRCR, 
FN_PISSALARY_COMP_AMT(C.COMPANYCODE,C.DIVISIONCODE,'REIMBURSEMENT PROCESS',C.COMPONENTCODE, '202004' , '02' , '001' , '')  AMOUNT, 
NULL ACCOSTCENTRECODE, '02' CATEGORYCODE, '001' UNITCODE, '' GRADECODE 
FROM PISCOMPONENTMASTER D, 
( 
    SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, ACCCODE 
    FROM PISCOMPONENTMASTER 
    WHERE COMPANYCODE = '0001' 
    AND DIVISIONCODE = '001' 
    AND ALLOWREIMBURSEMENT='Y'
    UNION ALL
    SELECT DISTINCT COMPANYCODE, DIVISIONCODE, COMPONENTCODE, EXPENSECODE 
    FROM PISCOMPONENTMASTER 
    WHERE COMPANYCODE = '0001' 
    AND DIVISIONCODE = '001' 
    AND ALLOWREIMBURSEMENT='Y'
) C ,ACACLEDGER B 
WHERE C.COMPANYCODE = '0001' 
AND C.DIVISIONCODE = '001' 
AND C.COMPANYCODE = D.COMPANYCODE 
AND C.DIVISIONCODE = D.DIVISIONCODE 
AND C.COMPONENTCODE=D.COMPONENTCODE 
AND B.COMPANYCODE = C.COMPANYCODE 
AND B.ACCODE = C.ACCCODE




SELECT FN_PISSALARY_COMP_AMT('0001','001','REIMBURSEMENT PROCESS','LTA', '202004' , '02' , '001' , '')
FROM DUAL

----------------------------------------------------------------------------------------


SELECT SUM(NVL(COMPONENTAMOUNT,0)) 
 FROM PISREIMBURSEMENTDETAILS 
 WHERE COMPANYCODE = '0001' AND DIVISIONCODE = '001' 
   AND YEARMONTH = '202004' 
   AND COMPONENTCODE = 'LTA' 
   AND CATEGORYCODE = '02'
   AND UNITCODE = '001'

SELECT SUM(NVL(PAIDAMOUNT,0)) 
FROM PISREIMBURSEMENTDETAILS A, PISEMPLOYEEMASTER B
WHERE A.COMPANYCODE = '0001' 
    AND A.DIVISIONCODE = '001' 
    AND A.YEARMONTH = '202004' 
    AND A.COMPONENTCODE = 'LTA' 
    AND B.CATEGORYCODE = '02'
    AND B.UNITCODE = '001'
    AND A.COMPANYCODE=B.COMPANYCODE
    AND A.DIVISIONCODE=B.DIVISIONCODE
    AND A.WORKERSERIAL=B.WORKERSERIAL
    AND A.TOKENNO=B.TOKENNO



SELECT SUM(NVL(COMPONENTAMOUNT,0)) 
 FROM PISREIMBURSEMENTDETAILS A, PISEMPLOYEEMASTER B
 WHERE A.COMPANYCODE = '0001' AND A.DIVISIONCODE = '001' 
   A.AND YEARMONTH = '202004' 
   A.AND COMPONENTCODE = 'LTA' 
   AND A.COMPANYCODE=B.COMPANYCODE
   AND A.DIVISIONCODE=B.DIVISIONCODE
   AND A.WORKERSERIAL=B.WORKERSERIAL
   AND A.TOKENNO=B.TOKENNO
   AND A.CATEGORYCODE = '02'
   AND UNITCODE = '001'


----------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------
