INSERT INTO GTT_ECRREPORT (
SERIAL_NO, COMPANYCODE,COMPANYNAME,DIVISIONCODE,DIVISIONNAME,UANNO,TOKENNO, WORKERNAME, PENSIONNO, PFNO, GROSSWAGES,  PF_GROSS,  PENSION_GROSS, 
  DLI_GROSS,  PENSION_CONTRIBUTION,  EPF_EE, EE_REFUND,NCPDAYS , 
 DOL,REASON,  WAGE_ARR, EE_ARR,ER_ARR,EPS_ARR, PFCATEGORY,AADHARNO,MODULE, REPORTHEADER ,PRINDATE, EX1, EX2, EX3, EX4 ) 
 
 
 
 SELECT SERIAL_NO, X.COMPANYCODE,C.COMPANYNAME,X.DIVISIONCODE,D.DIVISIONNAME,UANNO,TOKENNO, WORKERNAME, PENSIONNO, PFNO,ROUND(GROSSWAGES,0) GROSSWAGES, 
 ROUND(PF_GROSS,0) PF_GROSS,ROUND(PENSION_GROSS,0) PENSION_GROSS,ROUND(DLI_GROSS,0) DLI_GROSS,ROUND(ROUND(PENSION_GROSS,0) * 8.33/100,0) PENSION_CONTRIBUTION,
 0 EPF_EE, 0 EE_REFUND,NCPDAYS , 
 TO_CHAR(DOL,'DD/MM/YYYY') DOL, CASE WHEN  DOL IS NOT NULL THEN REASON ELSE NULL END REASON,  WAGE_ARR, EE_ARR,ER_ARR,EPS_ARR, PFCATEGORY,AADHARNO,MODULE,  
 'ECR Report NOVEMBER ,2020 (PIS)' ,TO_CHAR(SYSDATE,'DD/MM/YYYY') PRONTDATE,0 EX1,'' EX2,'' EX3,'' EX4 
 FROM 
 ( 
     SELECT 0 SERIAL_NO,B.COMPANYCODE,B.DIVISIONCODE, B.UANNO, B.TOKENNO, B.EMPLOYEENAME WORKERNAME, B.PENSIONNO, B.PFNO,  B.DATEOFBIRTH, NVL(A.GROSSEARN,0) GROSSWAGES, NVL(A.PF_GROSS,0) PF_GROSS, 
     CASE WHEN NVL(A.PEN_GROSS,0) >15000 THEN 15000 ELSE NVL(A.PEN_GROSS,0) END PENSION_GROSS, CASE WHEN PF_GROSS >= 15000 THEN 15000 ELSE PF_GROSS END DLI_GROSS, NVL(A.FPF,0) PENSION_CONTRIBUTION,0 EPF_EE,0 EE_REFUND, 
     /*CASE WHEN NVL(PF_GROSS,0)>=15000 THEN 0  ELSE CASE WHEN (ATTN_CALCF - ATTN_SALD)>0 THEN  (ATTN_CALCF - ATTN_SALD) ELSE 0 END END ELSE 0 END END*/ ATTN_WPAY   NCPDAYS,  
     CASE WHEN B.STATUSDATE >= TO_DATE('01/11/2020','DD/MM/YYYY') AND B.STATUSDATE <=  TO_DATE('30/11/2020','DD/MM/YYYY')  THEN B.STATUSDATE ELSE NULL END DOL, 
     CASE WHEN B.STATUSDATE IS NULL OR B.STATUSDATE > TO_DATE('30/11/2020','DD/MM/YYYY') THEN '' 
     ELSE   EMPLOYEESTATUS  
     END REASON, 
     0 WAGE_ARR, 0 EE_ARR, 0 ER_ARR, 0 EPS_ARR, 
     CASE WHEN  B.PFAPPLICABLE='Y' AND B.EPFAPPLICABLE='Y' THEN '2'       
          WHEN  B.PFAPPLICABLE='Y' AND B.EPFAPPLICABLE='N' THEN '1'      
     ELSE '3'      
     END AS PFCATEGORY,               
     B.AADHARNO,'PIS' MODULE 
     FROM PISPAYTRANSACTION A, PISEMPLOYEEMASTER B 
     WHERE A.WORKERSERIAL (+)= B.WORKERSERIAL 
       AND A.YEARCODE='2020-2021' 
       AND A.COMPANYCODE='NJ0001' 
       AND B.DATEOFCONFIRMATION <= TO_DATE('30/11/2020','DD/MM/YYYY') 
       AND (B.STATUSDATE IS NULL OR B.STATUSDATE >= TO_DATE('01/11/2020','DD/MM/YYYY')) 
       AND B.CATEGORYCODE IN ('40')    
       AND A.YEARMONTH>=  TO_NUMBER(TO_CHAR(TO_DATE('01/11/2020','DD/MM/YYYY'),'YYYYMM')) AND A.YEARMONTH<=TO_NUMBER(TO_CHAR(TO_DATE('30/11/2020','DD/MM/YYYY'),'YYYYMM')) 
     /*GROUP BY B.COMPANYCODE,B.DIVISIONCODE,B.UANNO, B.TOKENNO, B.EMPLOYEENAME, PENSIONNO, PFNO, 
              B.AADHARNO,B.STATUSDATE,B.EMPLOYEESTATUS,A.ATTN_WPAY, A.ATTN_SALD,B.PFAPPLICABLE,B.EPFAPPLICABLE,PF_GROSS */ 
 ) X, COMPANYMAST C,DIVISIONMASTER D
 WHERE X.COMPANYCODE=C.COMPANYCODE
   AND X.COMPANYCODE=D.COMPANYCODE
   AND X.DIVISIONCODE=D.DIVISIONCODE
   AND ROUND(MONTHS_BETWEEN(TO_DATE('30/11/2020','DD/MM/YYYY'),DATEOFBIRTH)/12,6)<= 58 



select * from pispaytransaction
where tokenno='71581'

select * from PISEMPLOYEEMASTER
where tokenno='71580'

 B 
 
 
 select ROUND(MONTHS_BETWEEN(TO_DATE('30/11/2020','DD/MM/YYYY'),TO_DATE('17/07/1973','DD/MM/YYYY'))/12,6) from dual
 
 
 
 SELECT 0 SERIAL_NO,B.COMPANYCODE,B.DIVISIONCODE, B.UANNO, B.TOKENNO, B.EMPLOYEENAME WORKERNAME, B.PENSIONNO, B.PFNO,  B.DATEOFBIRTH, NVL(A.GROSSEARN,0) GROSSWAGES, NVL(A.PF_GROSS,0) PF_GROSS, 
     CASE WHEN NVL(A.PEN_GROSS,0) >15000 THEN 15000 ELSE NVL(A.PEN_GROSS,0) END PENSION_GROSS, CASE WHEN PF_GROSS >= 15000 THEN 15000 ELSE PF_GROSS END DLI_GROSS, NVL(A.FPF,0) PENSION_CONTRIBUTION,0 EPF_EE,0 EE_REFUND, 
     /*CASE WHEN NVL(PF_GROSS,0)>=15000 THEN 0  ELSE CASE WHEN (ATTN_CALCF - ATTN_SALD)>0 THEN  (ATTN_CALCF - ATTN_SALD) ELSE 0 END END ELSE 0 END END*/ ATTN_WPAY   NCPDAYS,  
     CASE WHEN B.STATUSDATE >= TO_DATE('01/11/2020','DD/MM/YYYY') AND B.STATUSDATE <=  TO_DATE('30/11/2020','DD/MM/YYYY')  THEN B.STATUSDATE ELSE NULL END DOL, 
     CASE WHEN B.STATUSDATE IS NULL OR B.STATUSDATE > TO_DATE('30/11/2020','DD/MM/YYYY') THEN '' 
     ELSE   EMPLOYEESTATUS  
     END REASON, 
     0 WAGE_ARR, 0 EE_ARR, 0 ER_ARR, 0 EPS_ARR, 
     CASE WHEN  B.PFAPPLICABLE='Y' AND B.EPFAPPLICABLE='Y' THEN '2'       
          WHEN  B.PFAPPLICABLE='Y' AND B.EPFAPPLICABLE='N' THEN '1'      
     ELSE '3'      
     END AS PFCATEGORY,               
     B.AADHARNO,'PIS' MODULE 
     FROM PISPAYTRANSACTION A, PISEMPLOYEEMASTER B 
     WHERE A.WORKERSERIAL (+)= B.WORKERSERIAL 
       AND A.YEARCODE='2020-2021' 
       AND A.COMPANYCODE='NJ0001' 
       AND B.DATEOFCONFIRMATION <= TO_DATE('30/11/2020','DD/MM/YYYY') 
       AND (B.STATUSDATE IS NULL OR B.STATUSDATE >= TO_DATE('01/11/2020','DD/MM/YYYY')) 
       AND B.CATEGORYCODE IN ('40')    
       AND A.YEARMONTH>=  TO_NUMBER(TO_CHAR(TO_DATE('01/11/2020','DD/MM/YYYY'),'YYYYMM')) 
       AND A.YEARMONTH<=TO_NUMBER(TO_CHAR(TO_DATE('30/11/2020','DD/MM/YYYY'),'YYYYMM')) 
       AND A.TOKENNO='71581'
     /*
        GROUP BY B.COMPANYCODE,B.DIVISIONCODE,B.UANNO, B.TOKENNO, B.EMPLOYEENAME, PENSIONNO, PFNO, 
        B.AADHARNO,B.STATUSDATE,B.EMPLOYEESTATUS,A.ATTN_WPAY, A.ATTN_SALD,B.PFAPPLICABLE,B.EPFAPPLICABLE,PF_GROSS 
      */ 
 