select * from incr2020
where rev_desg is not null

select * from pisdesignationmaster

select DESIGNATIONCODE,DESIGNATIONDESC from pisdesignationmaster



CREATE TABLE TMP_DESG
(
    DESG_DESC VARCHAR2(100),
    DESG_CODE VARCHAR2(10)    
)



ALTER TABLE incr2020 ADD DESG_CODE VARCHAR2(10)

SELECT * FROM incr2020 A, 
(
    SELECT DISTINCT DESG_DESC, DESG_CODE FROM TMP_DESG
) B
WHERE A.REV_DESG=B.DESG_DESC

UPDATE incr2020 A SET DESG_CODE=
(
    SELECT DESG_CODE FROM 
    (
        SELECT DISTINCT DESG_DESC, DESG_CODE FROM TMP_DESG
    )
    WHERE A.REV_DESG=DESG_DESC
)


SELECT * FROM PISEMPLOYEEMASTER A,incr2020 B
WHERE A.TOKENNO=B.EMP_CD
and a.DESIGNATIONCODE = b.desg_code
and b.desg_code is not null

UPDATE PISEMPLOYEEMASTER A SET DESIGNATIONCODE=
(
    SELECT DESG_CODE FROM incr2020 B
    WHERE A.TOKENNO=B.EMP_CD
    and a.DESIGNATIONCODE <> b.desg_code
    and b.desg_code is not null
)
WHERE TOKENNO IN (
    SELECT EMP_CD FROM incr2020
    WHERE desg_code is not null
)

SELECT * FROM PISEMPLOYEEMASTER
WHERE TOKENNO IN (
    SELECT EMP_CD FROM incr2020
    WHERE 1=1--
    AND desg_code is null
    AND REV_DESG IS NOT NULL
)

SELECT * FROM incr2020 
WHERE REV_DESG IS NOT NULL
AND DESG_CODE IS NULL;




;

SELECT * FROM USER_TAB_COLUMNS
WHERE COLUMN_NAME LIKE '%PROMOT%'


UPDATE PISEMPLOYEEMASTER A SET LASTPROMOTIONDATE='01-OCT-2020' 
WHERE TOKENNO IN (
    SELECT EMP_CD FROM incr2020
    WHERE desg_code is not null
)


CREATE TABLE PISCOMPONENTASSIGNMENT_BK2810 AS

SELECT * FROM PISCOMPONENTASSIGNMENT_BK2810


WHERE TRANSACTIONTYPE='ASSIGNMENT'
AND YEARMONTH='202004'



SELECT * FROM incr2020 

WHERE REV_DESG IS NOT NULL




NPS_CONTR


SELECT COMPANYCODE, DIVISIONCODE, YEARCODE, YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, GRADECODE, WORKERSERIAL, TOKENNO, 
TRANSACTIONTYPE, SYSROWID, LASTMODIFIED, USERNAME, BASIC, DA, HRA_GROSS, HRA_PER, HRA, PF_GROSS, PEN_GROSS, 
ESI_GROSS, PTAX_GROSS, PF_E, PF_C, FPF, VPF_PERC, VPF, ESI_E, ESI_C, PTAX, LWF, SARR_ARRE, SARR_ARRD, 
SARR_PF_GROSS, SARR_NPF_GROSS, GROSSEARN, GROSSDEDN, MISC_BF, MISC_CF, TOTEARN, TOTDEDN, 
NETSALARY, LOAN_PFLN, LINT_PFLN, LOAN_SADV, LINT_SADV, LOAN_VADV, LINT_VADV, LOAN_HLOAN, 
LINT_HLOAN, EPF, ITAX, FUEL, OTH_ALLOW, CHILD_ALOW, CONV_ALOW, HRA_FIXED, MISC_EARN, ESI_RT, LTA, 
ADHOC, SPL_ALLOW, OT_AMT, OEPF, OE_NPF, HRA_PERC, ACT_PF_GRS, LIC, ELECTRIC, OTHR_DEDN, MEDICAL, 
LVENCSH_DAYS, LEAVE_ENC, ATN_INCNT, ATN_INCAMT, CLUB, CUMM_DAYS, CUM_PFGROS, ESI_RATE, CUMMPFEBAL, 
CUMMPFCBAL, CUMMVPFBAL, RT_BASIC, LNBL_BL, PER_ALLOW, MED_ALLOW, COMPSAVING, CHOWKIDARI, FURNITURE, 
CAR, LOTTERY, RECREATION, GAMES, SCHOOL_BUS, CONV_RT, LADIESCLUB, DAIRY, LIBRARY, OT_HRS, 
SUBSCRIPTION, HR_DEDN, SAL_ADV, LOAN_BL, LINT_BL, LIBL_BL, LOAN_STADV, LINT_STADV, LNBL_STADV, 
LIBL_STADV, LOAN_SA, LINT_SA, LNBL_SA, LIBL_SA, LOAN_PFL, LINT_PFL, LNBL_PFL, LIBL_PFL, 
ATTN_SALD, ATTN_HOLD, ATTN_WRKD, ATTN_LDAY, LDAY_PL, LDAY_SL, LDAY_CL, CUMM_PF_E, CUMM_PF_C, 
CUMM_VPF,LOAN_HPF,LINT_HPF,LNBL_HPF,LIBL_HPF,COMPS_ALLOW,CONV_FLAG, NPS_CONTR,CONV_AMT,MED_FLAG,MIN_PAY,MED_MONTH
FROM incr2020 A, PISEMPLOYEEMASTER B
WHERE A.EMP_CD=B.TOKENNO




INSERT INTO PISCOMPONENTASSIGNMENT
SELECT COMPANYCODE, DIVISIONCODE,'2020-2021' YEARCODE,'202010' YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, GRADECODE, WORKERSERIAL, TOKENNO, 
'ASSIGNMENT' TRANSACTIONTYPE,SYS_guid() SYSROWID,SYSDATE LASTMODIFIED,'SWT' USERNAME, 
A.BASIC, 0 DA, 0 HRA_GROSS, 0 HRA_PER, 0 HRA, 0 PF_GROSS, 0 PEN_GROSS, 
0 ESI_GROSS, 0 PTAX_GROSS, 0 PF_E, 0 PF_C, 0 FPF, 0 VPF_PERC, 0 VPF, 0 ESI_E, 0 ESI_C, 0 PTAX, 0 LWF, 0 SARR_ARRE, 0 SARR_ARRD, 
0 SARR_PF_GROSS, 0 SARR_NPF_GROSS, 0 GROSSEARN, 0 GROSSDEDN, 0 MISC_BF, 0 MISC_CF, 0 TOTEARN, 0 TOTDEDN, 
0 NETSALARY, 0 LOAN_PFLN, 0 LINT_PFLN, 0 LOAN_SADV, 0 LINT_SADV, 0 LOAN_VADV, 0 LINT_VADV, 0 LOAN_HLOAN, 
0 LINT_HLOAN, 0 EPF, 0 ITAX, 0 FUEL, 0 OTH_ALLOW, 0 CHILD_ALOW, 0 CONV_ALOW, 0 HRA_FIXED, 0 MISC_EARN, 0 ESI_RT, 0 LTA, 
A.ADHOC, 0 SPL_ALLOW, 0 OT_AMT, 0 OEPF, 0 OE_NPF, 0 HRA_PERC, 0 ACT_PF_GRS, 0 LIC, 0 ELECTRIC, 0 OTHR_DEDN, 0 MEDICAL, 
0 LVENCSH_DAYS, 0 LEAVE_ENC, 0 ATN_INCNT, 0 ATN_INCAMT, 0 CLUB, 0 CUMM_DAYS, 0 CUM_PFGROS, 0 ESI_RATE, 0 CUMMPFEBAL, 
0 CUMMPFCBAL, 0 CUMMVPFBAL, 0 RT_BASIC, 0 LNBL_BL, 0 PER_ALLOW, 0 MED_ALLOW, 0 COMPSAVING, 0 CHOWKIDARI, 0 FURNITURE, 
0 CAR, 0 LOTTERY, 0 RECREATION, 0 GAMES, 0 SCHOOL_BUS, 0 CONV_RT, 0 LADIESCLUB, 0 DAIRY, 0 LIBRARY, 0 OT_HRS, 
0 SUBSCRIPTION, 0 HR_DEDN, 0 SAL_ADV, 0 LOAN_BL, 0 LINT_BL, 0 LIBL_BL, 0 LOAN_STADV, 0 LINT_STADV, 0 LNBL_STADV, 
0 LIBL_STADV, 0 LOAN_SA, 0 LINT_SA, 0 LNBL_SA, 0 LIBL_SA, 0 LOAN_PFL, 0 LINT_PFL, 0 LNBL_PFL, 0 LIBL_PFL, 
0 ATTN_SALD, 0 ATTN_HOLD, 0 ATTN_WRKD, 0 ATTN_LDAY, 0 LDAY_PL, 0 LDAY_SL, 0 LDAY_CL, 0 CUMM_PF_E, 0 CUMM_PF_C, 
0 CUMM_VPF,0 LOAN_HPF,0 LINT_HPF,0 LNBL_HPF,0 LIBL_HPF,0 COMPS_ALLOW,0 CONV_FLAG, A.NPS_CONTR,0 CONV_AMT,
0 MED_FLAG,0 MIN_PAY,0 MED_MONTH,A.FURN_ALLOWN
FROM incr2020 A, PISEMPLOYEEMASTER B
WHERE A.EMP_CD=B.TOKENNO


SELECT * FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'

AND USERNAME='SWT'


 


SELECT * FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'
AND TOKENNO NOT IN ( SELECT EMP_CD FROM incr2020)


SELECT EMP_CD FROM incr2020
MINUS

SELECT TOKENNO FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'


UPDATE PISCOMPONENTASSIGNMENT A 
SET (BASIC, ADHOC,NPS_CONTR,FURN_ALLOWN) = 
(
    SELECT BASIC, ADHOC,NPS_CONTR,FURN_ALLOWN
    FROM incr2020 WHERE A.TOKENNO=EMP_CD
)
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'




SELECT EMP_CD FROM incr2020
MINUS
SELECT * FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'



SELECT TOKENNO,MAX(YEARMONTH) 
FROM PISCOMPONENTASSIGNMENT A
WHERE TOKENNO IN (
    SELECT EMP_CD FROM incr2020
    WHERE EMP_CD=A.TOKENNO
)
AND YEARMONTH < '202010'
AND TRANSACTIONTYPE='ASSIGNMENT'
GROUP BY TOKENNO



INSERT INTO PISCOMPONENTASSIGNMENT
SELECT COMPANYCODE, DIVISIONCODE, YEARCODE,'202010' YEARMONTH, UNITCODE, DEPARTMENTCODE, CATEGORYCODE, GRADECODE, WORKERSERIAL, TOKENNO, 
'ASSIGNMENT' TRANSACTIONTYPE,SYS_GUID() SYSROWID,SYSDATE LASTMODIFIED,'SWT' USERNAME, 
B.BASIC, 
DA, HRA_GROSS, HRA_PER, HRA, PF_GROSS, PEN_GROSS, 
ESI_GROSS, PTAX_GROSS, PF_E, PF_C, FPF, VPF_PERC, VPF, ESI_E, ESI_C, PTAX, LWF, SARR_ARRE, SARR_ARRD, 
SARR_PF_GROSS, SARR_NPF_GROSS, GROSSEARN, GROSSDEDN, MISC_BF, MISC_CF, TOTEARN, TOTDEDN, 
NETSALARY, LOAN_PFLN, LINT_PFLN, LOAN_SADV, LINT_SADV, LOAN_VADV, LINT_VADV, LOAN_HLOAN, 
LINT_HLOAN, EPF, ITAX, FUEL, OTH_ALLOW, CHILD_ALOW, CONV_ALOW, HRA_FIXED, MISC_EARN, ESI_RT, LTA, 
B.ADHOC, 
SPL_ALLOW, OT_AMT, OEPF, OE_NPF, HRA_PERC, ACT_PF_GRS, LIC, ELECTRIC, OTHR_DEDN, MEDICAL, 
LVENCSH_DAYS, LEAVE_ENC, ATN_INCNT, ATN_INCAMT, CLUB, CUMM_DAYS, CUM_PFGROS, ESI_RATE, CUMMPFEBAL, 
CUMMPFCBAL, CUMMVPFBAL, RT_BASIC, LNBL_BL, PER_ALLOW, MED_ALLOW, COMPSAVING, CHOWKIDARI, FURNITURE, 
CAR, LOTTERY, RECREATION, GAMES, SCHOOL_BUS, CONV_RT, LADIESCLUB, DAIRY, LIBRARY, OT_HRS, 
SUBSCRIPTION, HR_DEDN, SAL_ADV, LOAN_BL, LINT_BL, LIBL_BL, LOAN_STADV, LINT_STADV, LNBL_STADV, 
LIBL_STADV, LOAN_SA, LINT_SA, LNBL_SA, LIBL_SA, LOAN_PFL, LINT_PFL, LNBL_PFL, LIBL_PFL, 
ATTN_SALD, ATTN_HOLD, ATTN_WRKD, ATTN_LDAY, LDAY_PL, LDAY_SL, LDAY_CL, CUMM_PF_E, CUMM_PF_C, 
CUMM_VPF,LOAN_HPF,LINT_HPF,LNBL_HPF,LIBL_HPF,COMPS_ALLOW,CONV_FLAG, 
B.NPS_CONTR,
CONV_AMT,
MED_FLAG,MIN_PAY,MED_MONTH,
B.FURN_ALLOWN
FROM PISCOMPONENTASSIGNMENT A, incr2020 B
WHERE A.TOKENNO=B.EMP_CD
AND YEARMONTH  = 
(
    SELECT MAX(YEARMONTH) 
    FROM PISCOMPONENTASSIGNMENT 
    WHERE TOKENNO = A.TOKENNO
    AND YEARMONTH < '202010'
    AND TRANSACTIONTYPE='ASSIGNMENT'
)
AND TRANSACTIONTYPE='ASSIGNMENT'
AND A.TOKENNO NOT IN (
    SELECT TOKENNO FROM PISCOMPONENTASSIGNMENT 
    WHERE YEARMONTH = '202010'
    AND TRANSACTIONTYPE='ASSIGNMENT'
)


SELECT * FROM PISGRADECOMPONENTMAPPING
WHERE COMPONENTCODE='BASIC'


INSERT INTO PISGRADECOMPONENTMAPPING
SELECT COMPANYCODE, DIVISIONCODE, YEARMONTH, UNITCODE, CATEGORYCODE, 
GRADECODE,'FURN_ALLOWN' COMPONENTCODE, APPLICABLE,
'SWT' USERNAME,SYSDATE LASTMODIFIED,SYS_GUID() SYSROWID
FROM PISGRADECOMPONENTMAPPING
WHERE COMPONENTCODE='BASIC'



select tokenno,a.FURN_ALLOWN,b.FURN_ALLOWN  from pispaytransaction a, incr2020 b
where yearmonth='202010'
and a.tokenno=b.emp_cd
and nvl(b.FURN_ALLOWN,0) > 0
and a.FURN_ALLOWN <> b.FURN_ALLOWN




SELECT * FROM incr2020
where nvl(FURN_ALLOWN,0) > 0



SELECT EMP_CD FROM incr2020
MINUS
SELECT * FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'


----------------

ELECTRICMETERREADING

WPSELECTRICDATAGRID

WPSELECTRICRAWDATA

select * from menumaster_rnd
where menudesc like 'Elect%'


SELECT PARAMETER_VALUE FROM SYS_PARAMETER WHERE PARAMETER_NAME='ELECTRIC DATA IMPORT'


PROC_ELECTRIC_GRID_SHOW
PROC_ELECTRIC_GRID_SHOW



SELECT  A.LINENO ,A.QUARTERNO,M.METERNO,NVL(W.TOKENNO,'BJ0056') TOKENNO,NVL(W.EMPLOYEENAME,
 'BJM')WORKERNAME,
 NVL(ELEC_BAL_AMT,0) PREVIOUSDUEAMOUNT,
 RW.AMOUNT CONTRIBUTIONAMOUNT,
 FN_ROUNDOFFRS(((NVL(RW.AMOUNT,0)+NVL(BL.ELEC_BAL_AMT,0))),1,'H')EMIAMOUNT,
 TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY') EFFECTIVEDATE,
 TO_DATE(RW.READINGTODATE,'DD/MM/YYYY') RELEASEDATE,
 (CASE WHEN NVL(A.RELEASEDATE,TO_DATE(RW.READINGTODATE,'DD/MM/YYYY'))>=
 TO_DATE(RW.READINGTODATE,'DD/MM/YYYY') THEN TO_DATE(RW.READINGTODATE,'DD/MM/YYYY')
 ELSE  A.RELEASEDATE END)- TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY')+1 TOTALBILLDAYS,
 A.COMPANYCODE,A.DIVISIONCODE,TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY') READINGFROMDATE,
 TO_DATE(RW.READINGTODATE,'DD/MM/YYYY') READINGTODATE,
 0 NOOFUNIT,TO_DATE(RW.FORTNIGHTSTARTDATE,'DD/MM/YYYY'),TO_DATE(RW.FORTNIGHTENDDATE,'DD/MM/YYYY'), NVL(AMOUNT,0) BILLAMOUNT,W.WORKERSERIAL,
 (CASE WHEN NVL(A.RELEASEDATE,TO_DATE(RW.READINGTODATE,'DD/MM/YYYY'))>= 
 TO_DATE(RW.READINGTODATE,'DD/MM/YYYY') THEN TO_DATE(RW.READINGTODATE,'DD/MM/YYYY')
 ELSE  A.RELEASEDATE END)- TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY')+1 NOOFALLOCATIONDAYS,
 'SWT' USERNAME,NULL SYSROWID, TO_CHAR(TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY'),'YYYYMM') YEARMONTH ,TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY')  READINGDATE,
  DEPARTMENTCODE, 'WPS' MODULE,0 METERREADINGFROM, 0 METERREADINGTO, 0 FREEUNIT,0 CHARGEUNIT,0 UNIT_RATE, NVL(ELEC_BAL_AMT,0) PREV_DUE_AMT 
 FROM WPSELECTRICRAWDATA RW,QUARTERALLOCATIONDETAILS A,PISEMPLOYEEMASTER W,QUARTERMASTER M,GBL_ELECBLNC BL,
 (
     SELECT LINENO,QUARTERNO, MAX(EFFECTIVEDATE) EFFECTIVEDATE 
     FROM QUARTERALLOCATIONDETAILS
     WHERE COMPANYCODE='BJ0056' AND DIVISIONCODE='0001'
       AND EFFECTIVEDATE <= TO_DATE('31/10/2020','DD/MM/YYYY')
     GROUP BY QUARTERNO,LINENO
 ) B
 WHERE A.COMPANYCODE='BJ0056'  AND A.DIVISIONCODE='0001'
   AND A.QUARTERNO = B.QUARTERNO AND A.LINENO=B.LINENO AND A.EFFECTIVEDATE=B.EFFECTIVEDATE
   AND (A.RELEASEDATE IS NULL OR A.RELEASEDATE > TO_DATE('01/10/2020','DD/MM/YYYY'))
   AND A.COMPANYCODE=W.COMPANYCODE(+)
   AND A.DIVISIONCODE=W.DIVISIONCODE(+)
   AND A.WORKERSERIAL=W.WORKERSERIAL(+)
   AND A.COMPANYCODE=M.COMPANYCODE
   AND A.DIVISIONCODE=M.DIVISIONCODE
   AND A.LINENO=M.LINENO
   AND A.QUARTERNO=M.QUARTERNO
   AND A.QUARTERSTATUS='ALLOCATED'
   AND A.WORKERSERIAL=BL.WORKERSERIAL(+) 
   AND RW.QTRLINENO=M.LINENO
   AND RW.QTRNO=M.QUARTERNO 
   AND TO_DATE(RW.READINGFROMDATE,'DD/MM/YYYY') >= TO_DATE('01/10/2020','DD/MM/YYYY')
   AND TO_DATE(RW.READINGTODATE,'DD/MM/YYYY') <= TO_DATE('31/10/2020','DD/MM/YYYY')
   AND RW.FORTNIGHTSTARTDATE='01/10/2020'
   AND RW.FORTNIGHTENDDATE='31/10/2020'
    ORDER BY RW.QTRLINENO,RW.QTRNO
    
    
    
    SELECT * FROM SYS_TFMAP
    WHERE  SYS_TABLENAME_ACTUAL ='ELECTRICMETERREADING'
    AND SYS_TABLE_SEQUENCIER='15015'
    
    ELECTRICMETERREADING
    
    EXEC PROC_CREATE_GBL_TMP_TABLES(15015,0)
    
    
    SELECT * FROM ELECTRICMETERREADING WHERE YEARMONTH='202010'
	
	----------------------------------------------------
	
CREATE TABLE FURNISHING_DATA
(
EMP_CD VARCHAR2(10)    ,
NAME   VARCHAR2(100) ,
FUR_ALLOWN NUMBER(15,2)
)

SELECT * FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'
AND TOKENNO IN ( 
SELECT EMP_CD FROM FURNISHING_DATA
WHERE FUR_ALLOWN IS NOT NULL
)

CREATE TABLE FURNISHING_DATA
(
EMP_CD VARCHAR2(10)    ,
NAME   VARCHAR2(100) ,
FUR_ALLOWN NUMBER(15,2)
)

SELECT EMP_CD FROM FURNISHING_DATA
WHERE FUR_ALLOWN IS NOT NULL
MINUS
SELECT TOKENNO FROM PISCOMPONENTASSIGNMENT
WHERE YEARMONTH='202010'
AND TRANSACTIONTYPE='ASSIGNMENT'
AND TOKENNO IN ( 
SELECT EMP_CD FROM FURNISHING_DATA
WHERE FUR_ALLOWN IS NOT NULL
)



SELECT EMP_CD,COUNT(EMP_CD) FROM FURNISHING_DATA
WHERE 1=1 --FUR_ALLOWN IS NOT NULL
GROUP BY EMP_CD
HAVING COUNT(EMP_CD) >1