
SELECT A.VOUCHERNO, TO_CHAR(A.VOUCHERDATE,'DD/MM/YYYY') VOUCHERDATE, A.ACCODE, A.TDSTYPE, A.BILLNO, TO_CHAR(A.BILLDATE,'DD/MM/YYYY') BILLDATE, 
A.BILLAMOUNT, A.TOTALTDSAMOUNT, A.NETTDSAMOUNT,  A.TRANSACTIONTYPE, A.SYSTEMVOUCHERNO,A.SERVICETAXAMOUNT , A.EDUCATIONCESSAMOUNT, 
A.HSEDUCATIONCESSAMOUNT, A. PERCENTAGE, A.NETAMOUNT, A.TDSCODE , 
A.PAYMENTVOUCHERNO,TO_CHAR(A.PAYMENTVOUCHERDATE,'DD/MM/YYYY') PAYMENTVOUCHERDATE, 
A.CERTIFICATENO, TO_CHAR(A.CERTIFICATEDATE,'DD/MM/YYYY') CERTIFICATEDATE,A.BSRCODE, A.PAYSYSNO ,  
L.ACSHORTDESCRIPTION AS ACHEAD, L1.ACHEAD TDSHEAD, L1.ACCODE TDSCODE  
 From 
 ( 
  SELECT A.*, B.PAYMENTVOUCHERNO,B.VOUCHERDATE AS PAYMENTVOUCHERDATE, B.CERTIFICATENO, B.CERTIFICATEDATE,B.BSRCODE, B.PAYSYSNO 
  From 
  ( 
   SELECT V.VOUCHERNO, V.VOUCHERDATE, T.PARTYCODE ACCODE, T.TDSTYPE, T.BILLNO, T.BILLDATE, T.BILLAMOUNT, T.TOTALTDSAMOUNT, T.NETTDSAMOUNT,  T.TRANSACTIONTYPE, T.SYSTEMVOUCHERNO, 
          T.SERVICETAXAMOUNT , T.EDUCATIONCESSAMOUNT, T.HSEDUCATIONCESSAMOUNT, NVL(T.NETPERCENTAGE,T.PERCENTAGE) PERCENTAGE, T.NETAMOUNT, T.ACCODE TDSCODE 
   FROM ACTDSDETAILS T, ACVOUCHER V 
   WHERE T.COMPANYCODE ='0001' 
     AND T.DIVISIONCODE = '001' 
     AND T.YEARCODE ='2020-2021' 
     AND T.TRANSACTIONTYPE = 'TDS LIABILITY' 
     AND T.COMPANYCODE = V.COMPANYCODE 
     AND T.DIVISIONCODE = V.DIVISIONCODE 
     AND T.YEARCODE = V.YEARCODE 
     AND T.SYSTEMVOUCHERNO = V.SYSTEMVOUCHERNO 
     AND T.SYSTEMVOUCHERNO NOT IN ( 
                                    SELECT DISTINCT V.REFSYSTEMVOUCHERNO 
                                      FROM ACTDSDETAILS T, ACVOUCHER V 
                                     WHERE T.COMPANYCODE ='0001'  
                                       AND T.DIVISIONCODE = '001'  
                                       AND T.YEARCODE ='2020-2021' 
                                       AND T.TRANSACTIONTYPE = 'TDS LIABILITY REVERSAL'  
                                       AND T.COMPANYCODE = V.COMPANYCODE  
                                       AND T.DIVISIONCODE = V.DIVISIONCODE  
                                       AND T.YEARCODE = V.YEARCODE  
                                       AND T.SYSTEMVOUCHERNO = V.SYSTEMVOUCHERNO  
                                       AND V.VOUCHERDATE IS NOT NULL  
                                       AND V.VOUCHERNO IS NOT NULL  
                                       AND V.VOUCHERDATE <= TO_DATE('30/09/2020','DD/MM/YYYY') 
                                       AND T.ACCODE IN  ('T000134') 
                                  ) 
     AND V.VOUCHERDATE IS NOT NULL 
     AND V.VOUCHERNO IS NOT NULL 
     AND V.VOUCHERDATE <= TO_DATE('30/09/2020','DD/MM/YYYY')  
     AND T.ACCODE IN  ('T000134') 
  )A, 
  ( 
   SELECT V.VOUCHERNO, V.VOUCHERDATE, T.PARTYCODE ACCODE, T.TDSTYPE, T.BILLNO,T.BILLDATE, T.BILLAMOUNT, T.TOTALTDSAMOUNT, T.NETTDSAMOUNT,  T.TRANSACTIONTYPE, T.SYSTEMVOUCHERNO PAYSYSNO, 
          T.SERVICETAXAMOUNT, T.EDUCATIONCESSAMOUNT, T.HSEDUCATIONCESSAMOUNT, NVL(T.NETPERCENTAGE,T.PERCENTAGE) PERCENTAGE, V.VOUCHERNO AS PAYMENTVOUCHERNO, T.CERTIFICATENO, T.CERTIFICATEDATE, T.BSRCODE, T.ACCODE TDSCODE, T.REFSYSTEMVOUCHERNO 
   FROM ACTDSDETAILS T, ACVOUCHER V 
   WHERE T.COMPANYCODE ='0001' 
     AND V.DIVISIONCODE = '001' 
     AND T.TRANSACTIONTYPE = 'TDS LIABILITY ADJUSTMENT' 
     AND T.COMPANYCODE = V.COMPANYCODE 
     AND T.DIVISIONCODE = V.DIVISIONCODE 
     AND T.YEARCODE = V.YEARCODE 
     AND T.SYSTEMVOUCHERNO = V.SYSTEMVOUCHERNO 
     AND T.SYSTEMVOUCHERNO NOT IN ( 
                                    SELECT DISTINCT V.REFSYSTEMVOUCHERNO 
                                      FROM ACTDSDETAILS T, ACVOUCHER V 
                                     WHERE T.COMPANYCODE ='0001'  
                                       AND T.DIVISIONCODE = '001'  
                                       AND T.TRANSACTIONTYPE LIKE '%REVERSAL%'  
                                       AND T.COMPANYCODE = V.COMPANYCODE  
                                       AND T.DIVISIONCODE = V.DIVISIONCODE  
                                       AND T.YEARCODE = V.YEARCODE  
                                       AND T.SYSTEMVOUCHERNO = V.SYSTEMVOUCHERNO  
                                       AND V.VOUCHERDATE >= TO_DATE('01/09/2020','DD/MM/YYYY')   
                                       AND V.VOUCHERDATE <= TO_DATE('30/09/2020','DD/MM/YYYY')  
                                       AND T.ACCODE IN  ('T000134') 
                                  ) 
     AND V.VOUCHERDATE >= TO_DATE('01/09/2020','DD/MM/YYYY')  
     AND V.VOUCHERDATE <= TO_DATE('30/09/2020','DD/MM/YYYY')  
     AND T.ACCODE IN  ('T000134') 
  )B 
   WHERE A.SYSTEMVOUCHERNO  =  B.REFSYSTEMVOUCHERNO (+) 
    AND A.ACCODE   = B.ACCODE(+) 
    AND A.TDSTYPE  = B.TDSTYPE(+) 
    AND A.BILLNO   = B.BILLNO(+) 
    AND A.BILLDATE = B.BILLDATE(+) 
 )A,  ACACLEDGER L,  ACACLEDGER L1 
 WHERE A.ACCODE = L.ACCODE 
   AND L.COMPANYCODE = '0001' 
   AND A.TDSCODE = L1.ACCODE 
   AND L1.COMPANYCODE = '0001' 
     AND A.VOUCHERDATE >= TO_DATE('01/09/2020','DD/MM/YYYY')  
     AND A.VOUCHERDATE <= TO_DATE('30/09/2020','DD/MM/YYYY')  
     AND A.TDSCODE IN ('T000134') 
  ORDER BY  A.CERTIFICATEDATE,A.CERTIFICATENO,A.PAYMENTVOUCHERDATE, A.PAYMENTVOUCHERNO ,ACHEAD , A.BILLDATE,A.BILLNO 