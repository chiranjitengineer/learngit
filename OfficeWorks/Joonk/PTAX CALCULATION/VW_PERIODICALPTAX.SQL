DROP VIEW JOONK.VW_PERIODICALPTAX;

/* Formatted on 15/09/2020 1:05:36 PM (QP5 v5.115.810.9015) */
CREATE OR REPLACE FORCE VIEW JOONK.VW_PERIODICALPTAX
(
   COMPANYCODE,
   DIVISIONCODE,
   YEARCODE,
   TOKENNO,
   EFFECTIVEDATE,
   PTAXGROSS
)
AS
   
   SELECT   COMPANYCODE,
            DIVISIONCODE,
            YEARCODE,
            TOKENNO,
            PERIODFROM EFFECTIVEDATE,
            (GROSSWAGES - OT_AMOUNT) PTAXGROSS
     FROM   GPSPAYSHEETDETAILS
   UNION ALL
   SELECT   COMPANYCODE,
            DIVISIONCODE,
            YEARCODE,
            TOKENNO,
            OPDATE EFFECTIVEDATE,
            PTAXGROSS
     FROM   GPSOPPTAXGROSS
     UNION ALL
     select A.COMPANYCODE,
    A.DIVISIONCODE,
    A.YEARCODE,
    B.TOKENNO,
    TO_DATE( TO_CHAR(A.LASTMODIFIED,'DD/MM/YYYY') ,'DD/MM/YYYY') EFFECTIVEDATE,
    NETBONUS PTAXGROSS 
    from GPSBONUSPROCALCULATION_N A, GPSEMPLOYEEMAST B
    where flag='BONUS'
    AND A.COMPANYCODE=B.COMPANYCODE
    AND A.DIVISIONCODE=B.DIVISIONCODE
    AND A.WORKERSERIAL=B.WORKERSERIAL
    AND A.NETBONUS > 0;


select A.COMPANYCODE,
    A.DIVISIONCODE,
    A.YEARCODE,
    B.TOKENNO,
    TO_DATE( TO_CHAR(A.LASTMODIFIED,'DD/MM/YYYY') ,'DD/MM/YYYY') EFFECTIVEDATE,
    NETBONUS PTAXGROSS 
    from GPSBONUSPROCALCULATION_N A, GPSEMPLOYEEMAST B
where flag='BONUS'
AND A.COMPANYCODE=B.COMPANYCODE
AND A.DIVISIONCODE=B.DIVISIONCODE
AND A.WORKERSERIAL=B.WORKERSERIAL
AND A.NETBONUS > 0



SELECT * FROM VW_PERIODICALPTAX
WHERE DIVISIONCODE='0006'