EXEC PROC_RPT_PIS_PAYSLIP_ED('BJ0056','0001','2020-2021','202004','''01''','','','')

SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,LISTAGG(COMPONENTCODE, ',') WITHIN GROUP (ORDER BY PHASE,CALCULATIONINDEX) COMPONENTCODE
        FROM PISCOMPONENTMASTER
        WHERE COMPANYCODE='BJ0056'
        and DIVISIONCODE='0001'
        AND COMPONENTTYPE IS NOT NULL
        AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
        AND COMPONENTCODE <> 'NETSALARY'
        GROUP BY COMPANYCODE,DIVISIONCODE,COMPONENTTYPE
        
SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,WM_CONCAT(COMPONENTCODE)  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE , PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE IN ('EARNING') 
    ORDER BY PHASE,CALCULATIONINDEX
)
WHERE COMPANYCODE='BJ0056'
and DIVISIONCODE='0001'
AND COMPONENTTYPE IS NOT NULL
AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
AND COMPONENTCODE <> 'NETSALARY'
GROUP BY COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,COMPONENTCODE

ORDER BY PHASE,CALCULATIONINDEX


SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE , PHASE,CALCULATIONINDEX
FROM PISCOMPONENTMASTER ORDER BY PHASE,CALCULATIONINDEX


BASIC,COMPS_ALLOW,HRA,MED_ALLOW,CONV_ALOW,LEAVE_ENC,OT_AMT,OE_NPF,OEPF,SPL_ALLOW,PER_ALLOW,ADHOC,DA

BASIC,DA,ADHOC,PER_ALLOW,SPL_ALLOW,OEPF,OE_NPF,OT_AMT,LEAVE_ENC,CONV_ALOW,MED_ALLOW,HRA,COMPS_ALLOW



PF_E,OTHR_DEDN,LOTTERY,GAMES,LIBRARY,RECREATION,SCHOOL_BUS,SUBSCRIPTION,DAIRY,CAR,LADIESCLUB,CLUB,LIC,ITAX,LWF,CHOWKIDARI,FURNITURE,HR_DEDN,ELECTRIC,LINT_STADV,LOAN_STADV,LINT_SA,LOAN_SA,LINT_HPF,LINT_BL,LOAN_HPF,LOAN_BL,LINT_PFL,LOAN_PFL,SAL_ADV,COMPSAVING,PTAX,ESI_E,VPF

PF_E,VPF,ESI_E,PTAX,COMPSAVING,SAL_ADV,LOAN_PFL,LINT_PFL,LOAN_BL,LOAN_HPF,LINT_BL,LINT_HPF,LOAN_SA,LINT_SA,LOAN_STADV,LINT_STADV,ELECTRIC,HR_DEDN,FURNITURE,CHOWKIDARI,LWF,ITAX,LIC,CLUB,LADIESCLUB,CAR,DAIRY,SUBSCRIPTION,SCHOOL_BUS,RECREATION,LIBRARY,GAMES,LOTTERY,OTHR_DEDN



SELECT RTRIM(XMLAGG(XMLELEMENT(E,colname,',').EXTRACT('//text()') ORDER BY colname).GetClobVal(),',') AS LIST
FROM tablename;

 SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE --, PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    ORDER BY PHASE,CALCULATIONINDEX
    
--    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,LISTAGG(COMPONENTCODE, ',') WITHIN GROUP (ORDER BY PHASE,CALCULATIONINDEX) COMPONENTCODE
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,
    RTRIM(XMLAGG(XMLELEMENT(COMPONENTCODE,',').EXTRACT('//text()') ORDER BY COMPONENTCODE).GetClobVal(),',') COMPONENTCODE
        FROM PISCOMPONENTMASTER
        WHERE COMPANYCODE='BJ0056'
        and DIVISIONCODE='0001'
        AND COMPONENTTYPE IS NOT NULL
        AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
        AND COMPONENTCODE <> 'NETSALARY'
        GROUP BY COMPANYCODE,DIVISIONCODE,COMPONENTTYPE
        

SELECT RTRIM(XMLAGG(XMLELEMENT(COMPONENTCODE,',').EXTRACT('//text()') ORDER BY COMPONENTCODE),',') AS LIST
FROM PISCOMPONENTMASTER  WHERE COMPANYCODE='BJ0056'
        and DIVISIONCODE='0001'
        AND COMPONENTTYPE IS NOT NULL
        AND COMPONENTTYPE IN ('EARNING','DEDUCTION');
        
        
SELECT COMPONENTTYPE, LTRIM(MAX(SYS_CONNECT_BY_PATH(COMPONENTCODE,'~')) KEEP (DENSE_RANK LAST ORDER BY COMPONENTCODE),'~')  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE , PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE IN ('EARNING') 
    ORDER BY PHASE,CALCULATIONINDEX
)
WHERE COMPANYCODE='BJ0056'
and DIVISIONCODE='0001'
AND COMPONENTTYPE IS NOT NULL
AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
AND COMPONENTCODE <> 'NETSALARY'
GROUP BY COMPONENTTYPE --,COMPONENTCODE
CONNECT BY prev = PRIOR curr AND PRIOR COMPONENTCODE = COMPONENTCODE START WITH curr = 1 





        
SELECT COMPONENTTYPE, RTRIM(SUBSTR (RTRIM (XMLAGG(XMLELEMENT (e,COMPONENTCODE|| ', ')).EXTRACT ('//text()'),','),1,4000),',')  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE , PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE IN ('EARNING') 
    ORDER BY PHASE,CALCULATIONINDEX
)
WHERE COMPANYCODE='BJ0056'
and DIVISIONCODE='0001'
AND COMPONENTTYPE IS NOT NULL
AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
AND COMPONENTCODE <> 'NETSALARY'

GROUP BY COMPONENTTYPE --,COMPONENTCODE



select SUBSTR (RTRIM (XMLAGG(XMLELEMENT (e,SAUDANO|| ', ')).EXTRACT ('//text()'),','),1,4000)
FROM JWPROFORMAINVOICEVIEW B
WHERE A.PROFORMAINVNO=B.PROFORMAINVNO


CONNECT BY prev = PRIOR curr AND PRIOR COMPONENTCODE = COMPONENTCODE START WITH curr = 1 


SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,WM_CONCAT(COMPONENTCODE)  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE , PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE IN ('EARNING') 
    ORDER BY PHASE,CALCULATIONINDEX
)
WHERE COMPANYCODE='BJ0056'
and DIVISIONCODE='0001'
AND COMPONENTTYPE IS NOT NULL
AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
AND COMPONENTCODE <> 'NETSALARY'
GROUP BY COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,COMPONENTCODE


-----------------------------------------------------------------------------------

 WHERE COMPANYCODE='BJ0056'
        and DIVISIONCODE='0001'
        AND COMPONENTTYPE IS NOT NULL
        AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
        
        
        
        
        
        
        
SELECT DOCUMENTNO, DOCUMENTSERIAL, ITEMCODE, VATCST, EXCISE, rank() OVER (PARTITION by DOCUMENTNO ,DOCUMENTSERIAL, ITEMCODE order by CHARGESRL )  || '. ' || TAXNAME as TAXNAME 
FROM 
( 
SELECT X.DOCUMENTNO, X.DOCUMENTSERIAL, X.ITEMCODE, Y.SERIALNO CHARGESRL, --X.CHARGEAMOUNT, --X.CHARGECODE, Y.CHARGETYPE, 
DECODE (Y.CHARGETYPE,'VAT',SUBSTR(CHARGENAME, INSTR(CHARGENAME,'@')+1, INSTR(CHARGENAME,'%')-1 - INSTR(CHARGENAME,'@')), DECODE (Y.CHARGETYPE,'CST',SUBSTR(CHARGENAME, INSTR(CHARGENAME,'@')+1, INSTR(CHARGENAME,'%')-1 - INSTR(CHARGENAME,'@')),0)) VATCST, 
DECODE (Y.CHARGETYPE,'EXCISE',SUBSTR(CHARGENAME, INSTR(CHARGENAME,'@')+1, INSTR(CHARGENAME,'%')-1 - INSTR(CHARGENAME,'@')),0) EXCISE, 
CASE WHEN (Y.CHARGENATURE='FIXED' AND Y.ADDLESS<>'NONE') THEN Y.CHARGESHORTNAME || ' ' || X.CHARGEAMOUNT 
WHEN Y.BOSSCHARGECODE IS NULL THEN Y.CHARGESHORTNAME 
ELSE Y.CHARGESHORTNAME || ' ' || (SELECT CHARGEAMOUNT FROM STORESCHARGEDETAILS WHERE COMPANYCODE = '0001' AND DIVISIONCODE = '002' AND DOCUMENTTYPE = X.DOCUMENTTYPE AND CHARGECODE = Y.BOSSCHARGECODE AND DOCUMENTNO=X.DOCUMENTNO AND DOCUMENTSERIAL=X.DOCUMENTSERIAL) || Y.BOSSCHRSYMBOL 
END TAXNAME 
FROM STORESCHARGEDETAILS X, CHARGEMASTER Y 
WHERE X.COMPANYCODE = '0001' AND X.DIVISIONCODE = '002' 
AND X.DOCUMENTTYPE = 'PURCHASE ORDER DRAFT' 
AND X.COMPANYCODE = Y.COMPANYCODE AND X.DIVISIONCODE = Y.DIVISIONCODE 
AND X.CHARGECODE = Y.CHARGECODE AND X.CHANNELCODE = Y.CHANNELCODE 
AND Y.MODULE = 'STORES' 
AND (Y.CHARGENATURE<>'FIXED' OR Y.ADDLESS<>'NONE') 
ORDER BY Y.SERIALNO 
) ORDER BY DOCUMENTNO, DOCUMENTSERIAL, ITEMCODE



select SUBSTR (RTRIM (XMLAGG(XMLELEMENT (e,SAUDANO|| ', ')).EXTRACT ('//text()'),','),1,4000)
FROM JWPROFORMAINVOICEVIEW B
WHERE A.PROFORMAINVNO=B.PROFORMAINVNO


SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,LISTAGG(COMPONENTCODE, ',') WITHIN GROUP (ORDER BY PHASE,CALCULATIONINDEX) COMPONENTCODE


SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE,
SUBSTR (RTRIM (XMLAGG(XMLELEMENT (e,COMPONENTCODE|| ', ')).EXTRACT ('//text()'),','),1,4000) COMPONENTCODE
        FROM PISCOMPONENTMASTER
        WHERE COMPANYCODE='BJ0056'
        and DIVISIONCODE='0001'
        AND COMPONENTTYPE IS NOT NULL
        AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
        AND COMPONENTCODE <> 'NETSALARY'
        GROUP BY COMPANYCODE,DIVISIONCODE,COMPONENTTYPE
        
        

SELECT  'EARNING' COMPONENTTYPE, WM_CONCAT(COMPONENTCODE)  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE --, PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE IN ('EARNING') 
    ORDER BY COMPONENTTYPE,PHASE,CALCULATIONINDEX
)
UNION ALL
SELECT  'DEDUCTION' COMPONENTTYPE, WM_CONCAT(COMPONENTCODE)  COMPONENTCODE
FROM 
(
    SELECT COMPANYCODE,DIVISIONCODE,COMPONENTTYPE, COMPONENTCODE --, PHASE,CALCULATIONINDEX
    FROM PISCOMPONENTMASTER
    WHERE COMPANYCODE='BJ0056'
    and DIVISIONCODE='0001'
    AND COMPONENTTYPE IS NOT NULL
--    AND COMPONENTTYPE IN ('EARNING','DEDUCTION') 
    AND COMPONENTTYPE = 'DEDUCTION'
    ORDER BY COMPONENTTYPE,PHASE,CALCULATIONINDEX
)



WHERE COMPANYCODE='BJ0056'
and DIVISIONCODE='0001'
AND COMPONENTTYPE IS NOT NULL
AND COMPONENTTYPE IN ('EARNING','DEDUCTION')
--AND COMPONENTCODE <> 'NETSALARY'

GROUP BY COMPONENTTYPE 