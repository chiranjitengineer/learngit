INSERT INTO GRATUITYENTITLEMENTYEAR_BK

SELECT * FROM GRATUITYENTITLEMENTYEAR

 


SELECT * FROM MENUMASTER_RND
WHERE UPPER(MENUDESC) LIKE UPPER('%pf IN%')

SELECT * FROM MENUMASTER_RND
WHERE MENUCODE=''

SELECT * FROM ROLEDETAILS
WHERE MENUCODE=''

SELECT * FROM REPORTPARAMETERMASTER
WHERE REPORTTAG=''


prcPIS_PFSettlement_b4Save

prcPIS_PFSettlement_AftrSave



PISEMPLOYEEMASTER

PISEMPLOYEEMASTER

TRG_INSUPD_PISEMPLOYEEMASTER


SELECT * FROM PFSETTLEMENT
WHERE PFNO='MO1184'

SELECT * FROM SYS_PARAMETER
WHERE 1=1
AND PARAMETER_NAME = 'PF INTEREST CLACULATION'

PRC_PFINTERESTCALC_ONOPENING


SELECT * FROM PFTRANSACTIONDETAILS
WHERE PFNO='MO1184'
AND YEARCODE ='2020-2021' 
   AND TRANSACTIONTYPE ='PF INTEREST CALCULATION' 


SELECT * FROM PFTRANSACTIONDETAILS
WHERE PFNO='MO0961'
AND YEARCODE ='2020-2021' 
   AND TRANSACTIONTYPE ='PF INTEREST CALCULATION' 






SELECT * FROM PFEMPLOYEEMASTER
WHERE PFNO='MO1184'

SELECT * FROM PISEMPLOYEEMASTER
WHERE TOKENNO='71297'



EXEC PRC_PFINTERESTCALC_ONOPENING('NJ0002','0010','PFTRANSACTIONDETAILS','2020-2021',8.7,'N','MO1184','30/11/2020','')


DELETE wps_error_log

SELECT * FROM wps_error_log


SELECT * FROM PFTRANSACTIONDETAILS
WHERE PFNO='MO1184'
AND  YEARCODE ='2020-2021' 
   AND TRANSACTIONTYPE ='PF INTEREST CALCULATION' 
   AND PFNO NOT IN (SELECT PFNO FROM PFEMPLOYEEMASTER WHERE PFSETTLEMENTDATE IS NOT NULL) 

SELECT PFNO FROM PFEMPLOYEEMASTER WHERE PFSETTLEMENTDATE IS NOT NULL
AND PFNO='MO1184'



DELETE FROM PFTRANSACTIONDETAILS 
 WHERE YEARCODE ='2020-2021' 
   AND TRANSACTIONTYPE ='PF INTEREST CALCULATION' 
   AND PFNO NOT IN (SELECT PFNO FROM PFEMPLOYEEMASTER WHERE PFSETTLEMENTDATE IS NOT NULL) 
 AND PFNO  = 'MO1184' 
 
 
  INSERT INTO PFTRANSACTIONDETAILS 
  
SELECT DISTINCT A.COMPANYCODE,A.DIVISIONCODE, YEARCODE,  202011 YEARMONTH,
TO_DATE('01/11/2020','DD/MM/YYYY') STARTDATE,TO_DATE('30/11/2020','DD/MM/YYYY') ENDDATE,A.PFNO,B.WORKERSERIAL,
B.TOKENNO,COMPONENTCODE, SUM(OPENING) COMPONENTAMOUNT  ,'PF INTEREST CALCULATION' TRANSACTIONTYPE ,
B.MODULE POSTEDFROM ,DECODE(B.MODULE,'WPS','WORKER','PIS','STAFF') EMPLOYMENTTYPE,'ADD' ADDLESS,
'T001'PFTRUSTCODE ,8.7 INT_PER,
CASE WHEN NVL(ISOPERATIVE,'Y')<>'Y' THEN 0 ELSE ROUND((SUM(OPENING)*8.7/100)*(8 /12),2)  END AS INT_AMT ,
CASE WHEN NVL(ISOPERATIVE,'Y')<>'Y' THEN SUM(OPENING) ELSE
ROUND((SUM(OPENING) + SUM(CONTR) + (SUM(OPENING)*8.7/100)*(8 /12)),2) END AS TOTAL_AMT,
B.PENSIONNO,0 AVERAGEBALANCE,B.COMPANYCODE EMPLOYEECOMPANYCODE,B.DIVISIONCODE EMPLOYEEDIVISIONCODE,B.MODULE,0 ADJ_AMT,'PF INTEREST CALCULATION' REMARKS,
NULL VOUCHERNO,NULL VOUCHERDATE,NULL SYSTEMVOUCHERNO,NULL SYSTEMVOUCHERDATE,NULL APPLICATIONDATE ,NULL APPLICATIONNO, SYSDATE LASTMODIFIEDDATE, 'SWT' USERNAME, SYS_GUID() SYSROWID
FROM  
( 
    SELECT COMPANYCODE, DIVISIONCODE, EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE, YEARCODE, SUM(OPENING) OPENING, SUM(CONTR) CONTR 
    FROM 
    ( 
        SELECT COMPANYCODE ,DIVISIONCODE ,EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE, YEARCODE, 
        SUM(COMPONENTAMOUNT) OPENING,0 CONTR 
        FROM PFTRANSACTIONDETAILS 
        WHERE COMPANYCODE ='NJ0002'
        AND YEARCODE ='2020-2021' 
        AND TRANSACTIONTYPE ='PF INTEREST OPENING BALANCE' 
        GROUP BY COMPANYCODE, DIVISIONCODE ,EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE, EMPLOYEECOMPANYCODE , YEARCODE 
        UNION ALL 
        SELECT COMPANYCODE, DIVISIONCODE ,EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE,  YEARCODE, 0 OPENING, 
        SUM(COMPONENTAMOUNT) CONTR 
        FROM PFTRANSACTIONDETAILS 
        WHERE COMPANYCODE ='NJ0002'
        AND YEARCODE ='2020-2021' 
        AND TRANSACTIONTYPE <>'PF INTEREST OPENING BALANCE' 
        AND TRANSACTIONTYPE <>'PF INTEREST CALCULATION' 
        GROUP BY COMPANYCODE, DIVISIONCODE ,EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE, EMPLOYEECOMPANYCODE , YEARCODE 
    ) 
    GROUP BY COMPANYCODE,DIVISIONCODE , EMPLOYEECOMPANYCODE ,EMPLOYEEDIVISIONCODE  ,PFNO,COMPONENTCODE, YEARCODE 
) A, PFEMPLOYEEMASTER B 
WHERE A.COMPANYCODE ='NJ0002'
AND A.YEARCODE ='2020-2021' 
AND B.PFSETTLEMENTDATE IS NULL
AND A.PFNO  = 'MO1184' 
AND A.COMPANYCODE=B.COMPANYCODE
AND A.DIVISIONCODE=B.DIVISIONCODE
AND A.PFNO=B.PFNO 
GROUP BY  A.COMPANYCODE,A.DIVISIONCODE, YEARCODE, A.PFNO, COMPONENTCODE,B.WORKERSERIAL,
B.TOKENNO,B.PENSIONNO,B.COMPANYCODE,B.DIVISIONCODE ,B.MODULE,ISOPERATIVE
ORDER BY PFNO, COMPONENTCODE 


SELECT LOANCODE, LOANDATE --INTO lv_LoanCode,lv_LoanDate
        FROM PFLOANTRANSACTION
        WHERE COMPANYCODE='NJ0002' AND DIVISIONCODE = '0010'
          AND PFNO = 'MO1184'
          AND LOANDATE = ( SELECT MAX(LOANDATE) LOANDATE FROM PFLOANTRANSACTION
                           WHERE COMPANYCODE='NJ0002' AND DIVISIONCODE = '0010'
                             AND PFNO = 'MO1184'
                             AND LOANTYPE = 'REFUNDABLE'
                         )
          AND LOANTYPE = 'REFUNDABLE'; 
          
          
 
SELECT MODULE,PFSETTLEMENTDATE FROM PFEMPLOYEEMASTER
WHERE PFNO IN (         
    'MO1311',
    'MO1327',
    'MO1337',
    'MO0961',
    'SE0838',
    'WS0871',
    'WS1102',
    'BA0813'
    ) 
    
    
SELECT PFSETTELMENTDATE FROM PISEMPLOYEEMASTER
WHERE PFNO IN (         
    'MO1311',
    'MO1327',
    'MO1337',
    'MO0961',
    'SE0838',
    'WS0871',
    'WS1102',
    'BA0813'
    ) 
    
 PFSETTLEMENTDATE  
 PFSETTELMENTDATE 
    
UPDATE  PFEMPLOYEEMASTER SET   PFSETTLEMENTDATE = NULL
WHERE PFNO IN (         
    'MO1311',
    'MO1327',
    'MO1337',
    'MO0961',
    'SE0838',
    'WS0871',
    'WS1102',
    'BA0813'
    ) 



SELECT * FROM PFSETTLEMENT
WHERE PFNO='MO1184'
    
SELECT * FROM PFSETTLEMENT
WHERE PFNO IN (         
    'MO1311',
    'MO1327',
    'MO1337',
    'MO0961',
    'SE0838',
    'WS0871',
    'WS1102',
    'BA0813'
    ) 