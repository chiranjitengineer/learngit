SELECT * FROM MENUMASTER_RND
WHERE MENUDESC LIKE 'PF and Loan %'

select * from menumaster_rnd
where menucode LIKE '010703030%'

select * from roledetails
where menucode='0107030308'

SET DEFINE OFF;
Insert into BIRLANEW.MENUMASTER_RND
   (MENUCODE, MENUNAME, MENUDESC, MENUTYPE, MENUTAG, 
    MENUTAG1, MENUTAG2, ENTRYPOSSIBLE, EDITPOSSIBLE, DELETEPOSSIBLE, 
    REPORTSPOSSIBLE, UTILITIESPOSSIBLE, ACTIVE, PROJECTNAME, MENUDETAILS, 
    EFFECTIVEDIVISION, EFFECTIVEINDIVISION, PROCEDURE_SAVE_EDIT, URLSRC, FRM_HEIGHT, 
    FRM_WIDTH, FUNCTIONCALL_BEFORE, FUNCTIONCALL_AFTER, VIEWPOSSIBLE, PRINTPOSSIBLE, 
    DOCDATEVALIDATEFIELD, KEY_TABLE)
 Values
   ('0107030309', NULL, 'PTAX Deduction', 'REPORTS', 'PIS TEXT REPORT BIRLA', 
    'PTAX DEDUCTION TEXT', 'PROC_RPT_PTAXDEDN_TEXT(''COMPANYCODE'',''DIVISIONCODE'',''YEARCODE'',''txtYEARMONTH'',''btnUnit'',''btnCategory'') ', 'N', 'N', 'N', 
    'Y', 'N', 'Y', 'PIS', NULL, 
    NULL, '''0001'',''0003'',''0002'',''0004''', NULL, 'PIS/Pages/Report/pgReportPISTemplate.aspx', NULL, 
    NULL, NULL, NULL, NULL, NULL, 
    NULL, NULL);
COMMIT;


PROC_RPT_PTAXDEDN_TEXT('COMPANYCODE','DIVISIONCODE','YEARCODE','txtYEARMONTH','btnUnit','btnCategory') 


EXEC PROC_RPT_PTAXDEDN_TEXT('BJ0056','0001','2020-2021','202007') 


PROC_RPT_ESISTATEMENT_EXL('COMPANYCODE','DIVISIONCODE','YEARCODE','txtYEARMONTH','btnUnit','btnCategory') 




PROC_RPT_ESISTATEMENT_EXL

DROP TABLE BIRLANEW.GTT_PIS_ESISTATEMENT_REP CASCADE CONSTRAINTS;

CREATE GLOBAL TEMPORARY TABLE BIRLANEW.GTT_PIS_ESISTATEMENT_REP
(
  COMPANYCODE    VARCHAR2(10 BYTE),
  DIVISIONCODE   VARCHAR2(10 BYTE),
  UNITCODE       VARCHAR2(10 BYTE),
  UNITSHORTDESC  VARCHAR2(20 BYTE),
  HAND           NUMBER,
  CATEGORYCODE   VARCHAR2(10 BYTE),
  CATEGORYDESC   VARCHAR2(500 BYTE),
  ESI_GROSS      NUMBER,
  ESI_E          NUMBER,
  ESI_C          NUMBER
)
ON COMMIT PRESERVE ROWS


SELECT * FROM PTAXSLAB

CREATE GLOBAL TEMPORARY TABLE GTT_PIS_PTAXDEDN_REP AS

SELECT A.COMPANYCODE, A.DIVISIONCODE, STATENAME,SLABAMOUNTFROM, SLABAMOUNTTO,  SUM(ARREAR_PTAX) ARREAR_PTAX, 
PTAX PTAX_RATE, COUNT(TOKENNO) MEMCOUNT, SUM(PTAX) TOTAL_PTAX 
FROM 
(
    SELECT A.COMPANYCODE, A.DIVISIONCODE, STATENAME, A.TOKENNO, PTAX, PTAX_GROSS,SLABAMOUNTFROM,SLABAMOUNTTO , 0 ARREAR_PTAX
    FROM PISPAYTRANSACTION A , PTAXSLAB B, PISEMPLOYEEMASTER E
    WHERE A.PTAX=B.PTAXAMOUNT 
    AND A.COMPANYCODE=E.COMPANYCODE
    AND A.DIVISIONCODE=E.DIVISIONCODE
    AND A.WORKERSERIAL=E.WORKERSERIAL
    AND A.TOKENNO=E.TOKENNO
    AND E.PTAXSTATE=B.STATENAME
    AND WITHEFFECTFROM = (SELECT MAX(WITHEFFECTFROM) FROM PTAXSLAB WHERE B.STATENAME=STATENAME)
) A
GROUP BY  A.COMPANYCODE, A.DIVISIONCODE, STATENAME,SLABAMOUNTFROM, SLABAMOUNTTO, PTAX
ORDER BY SLABAMOUNTFROM


SELECT TOKENNO, PTAXSTATE FROM PISEMPLOYEEMASTER

-----------------------------------------------------------------------

SET DEFINE OFF;
Insert into BIRLANEW.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('59', '0107030309', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202009041631020011148981');
Insert into BIRLANEW.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('54', '0107030309', 'X', NULL, 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202003131131450010180969');
Insert into BIRLANEW.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('52', '0107030309', 'X', NULL, 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202005070846440010402103');
Insert into BIRLANEW.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('1', '0107030309', 'X', NULL, 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202005081119420010404594');
Insert into BIRLANEW.ROLEDETAILS
   (ROLEID, MENUCODE, ACCESSENTRY, ACCESSEDIT, ACCESSDELETE, 
    ACCESSREPORT, ACCESSUTILITIES, ACCESSVIEW, ACCESSPRINT, PROJECTNAME, 
    SYSROWID)
 Values
   ('63', '0107030309', 'X', 'X', 'X', 
    'Y', 'X', 'X', 'X', 'PIS', 
    '202009071809340011271394');
COMMIT;

